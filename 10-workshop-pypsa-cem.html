

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Capacity Expansion Planning with pypsa &#8212; Data Science for Energy System Modelling</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '10-workshop-pypsa-cem';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Preparation for Group Assignment" href="11-workshop-groupwork.html" />
    <link rel="prev" title="Introduction to pypsa" href="09-workshop-pypsa.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01-workshop-python.html">Introduction to <code class="docutils literal notranslate"><span class="pre">Python</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="02-workshop-numpy.html">Introduction to <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="03-workshop-pandas.html">Introduction to <code class="docutils literal notranslate"><span class="pre">pandas</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="04-workshop-geopandas.html">Introduction to <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> and <code class="docutils literal notranslate"><span class="pre">cartopy</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="06-workshop-atlite.html">Introduction to <code class="docutils literal notranslate"><span class="pre">rasterio</span></code> and <code class="docutils literal notranslate"><span class="pre">atlite</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="07-workshop-networkx.html">Introduction to <code class="docutils literal notranslate"><span class="pre">networkx</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="08-workshop-pyomo.html">Introduction to <code class="docutils literal notranslate"><span class="pre">pyomo</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="09-workshop-pypsa.html">Introduction to <code class="docutils literal notranslate"><span class="pre">pypsa</span></code></a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Capacity Expansion Planning with <code class="docutils literal notranslate"><span class="pre">pypsa</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="11-workshop-groupwork.html">Preparation for Group Assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="12-workshop-pypsa-sector-coupling.html">Sector-Coupling with <code class="docutils literal notranslate"><span class="pre">pypsa</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="13-workshop-interactive-visualisation.html">Interactive Visualisation and Dashboards</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/fneum/data-science-for-esm/main?urlpath=tree/data-science-for-esm/10-workshop-pypsa-cem.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/fneum/data-science-for-esm/blob/main/data-science-for-esm/10-workshop-pypsa-cem.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/fneum/data-science-for-esm" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/fneum/data-science-for-esm/issues/new?title=Issue%20on%20page%20%2F10-workshop-pypsa-cem.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/10-workshop-pypsa-cem.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Capacity Expansion Planning with pypsa</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#from-electricity-market-modelling-to-capacity-expansion-planning">From electricity market modelling to capacity expansion planning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites-handling-technology-data-and-costs">Prerequisites: handling technology data and costs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-time-series-data">Loading time series data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-capacity-expansion-planning-example">Simple capacity expansion planning example</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-initialisation">Model Initialisation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-components">Adding Components</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-run">Model Run</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-evaluation">Model Evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-optimal-dispatch">Plotting Optimal Dispatch</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-storage-units">Adding Storage Units</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-emission-limits">Adding emission limits</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-analysis">Sensitivity Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="capacity-expansion-planning-with-pypsa">
<h1>Capacity Expansion Planning with <code class="docutils literal notranslate"><span class="pre">pypsa</span></code><a class="headerlink" href="#capacity-expansion-planning-with-pypsa" title="Permalink to this headline">#</a></h1>
<img src="https://github.com/fneum/data-science-for-esm/raw/main/data-science-for-esm/pypsa-logo.png" width="300px" /><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Also in this tutorial, you might want to refer to the PyPSA documentation: <a class="reference external" href="https://pypsa.readthedocs.io">https://pypsa.readthedocs.io</a>.</p>
</div>
<section id="from-electricity-market-modelling-to-capacity-expansion-planning">
<h2>From electricity market modelling to capacity expansion planning<a class="headerlink" href="#from-electricity-market-modelling-to-capacity-expansion-planning" title="Permalink to this headline">#</a></h2>
<p>Review the problem formulation of the electricity market model. Below you can find an adapted version
where the capacity limits have been promoted to <strong>decision variables</strong> with corresponding terms
in the <em>objective function</em> and <em>new constraints for their expansion limits</em> (e.g. wind and solar potentials). This is known as <strong>capacity expansion problem</strong>.</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
    \min_{g,e,f,G,E,F} \quad \sum_{i,s,t} w_t o_{s} g_{i,s,t} + \sum_{i,s} c_sG_{i,s}  + c_{r,\text{dis/charge}}G_{i,r, \text{dis/charge}} +   c_{r}E_{i,r}  + c_\ell F_{\ell}
  \end{equation*}\]</div>
<p>such that</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
    d_{i,t} &amp;= \sum_s g_{i,s,t}  - \sum_\ell K_{i\ell} f_{\ell,t}   &amp; \text{energy balance} \\
    0 &amp;\leq g_{i,s,t} \leq \hat{g}_{i,s,t} G_{i,s} &amp; \text{generator limits}\\
    0 &amp; \leq g_{i,r,t,\text{dis/charge}} \leq G_{i,r,\text{dis/charge}}&amp; \text{storage dis/charge limits} \\
    0 &amp; \leq e_{i,r,t} \leq E_{r} &amp; \text{storage energy limits} \\ 
    e_{i,r,t} &amp;= \eta^0_{i,r,t} e_{i,r,t-1} + \eta^1_{r}g_{i,r,t,\text{charge}} -  \frac{1}{\eta^2_{r}} g_{i,r,t,\text{discharge}} &amp; \text{storage consistency} \\
    -F_\ell &amp;\leq f_{\ell,t} \leq F_\ell  &amp; \text{line limits} \\
    0 &amp;= \sum_\ell C_{\ell c} x_\ell f_{\ell,t} &amp; \text{KVL} \\
        \underline{G}_{i,s} &amp; \leq G_{i,s} \leq \overline{G}_{i,s} &amp; \text{generator capacity expansion limits} \\
    \underline{G}_{i,r, \text{dis/charge}} &amp; \leq G_{i,r, \text{dis/charge}} \leq \overline{G}_{i,r, \text{dis/charge}} &amp; \text{storage power capacity expansion limits} \\
    \underline{E}_{i,r} &amp; \leq E_{i,r} \leq \overline{E}_{i,r} &amp; \text{storage energy expansion limits} \\
    \underline{F}_{\ell} &amp; \leq F_{\ell} \leq \overline{F}_{\ell} &amp; \text{line capacity expansion limits}
  \end{align*}\]</div>
<p><strong>New decision variables for capacity expansion planning:</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(G_{i,s}\)</span> is the generator capacity at bus <span class="math notranslate nohighlight">\(i\)</span>, technology <span class="math notranslate nohighlight">\(s\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(F_{\ell}\)</span> is the transmission capacity of line <span class="math notranslate nohighlight">\(\ell\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(G_{i,r,\text{dis-/charge}}\)</span> denotes the charge and discharge capacities of storage unit <span class="math notranslate nohighlight">\(r\)</span> at bus <span class="math notranslate nohighlight">\(i\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(E_{i,r}\)</span> is the energy capacity of storage <span class="math notranslate nohighlight">\(r\)</span> at bus <span class="math notranslate nohighlight">\(i\)</span> and time step <span class="math notranslate nohighlight">\(t\)</span>.</p></li>
</ul>
<p><strong>New parameters for capacity expansion planning:</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(c_{\star}\)</span> is the capital cost of technology <span class="math notranslate nohighlight">\(\star\)</span> at bus <span class="math notranslate nohighlight">\(i\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(w_t\)</span> is the weighting of time step <span class="math notranslate nohighlight">\(t\)</span> (e.g. number of hours it represents)</p></li>
<li><p><span class="math notranslate nohighlight">\(\underline{G}_\star, \underline{F}_\star, \underline{E}_\star\)</span> are the minimum capacities per technology and location/connection.</p></li>
<li><p><span class="math notranslate nohighlight">\(\underline{G}_\star, \underline{F}_\star, \underline{E}_\star\)</span> are the maximum capacities per technology and location.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a full reference to the optimisation problem description, see <a class="reference external" href="https://pypsa.readthedocs.io/en/latest/optimal_power_flow.html">https://pypsa.readthedocs.io/en/latest/optimal_power_flow.html</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have not yet set up Python on your computer, you can execute this tutorial in your browser via Google Colab. Click on the rocket in the top right corner and launch “Colab”. If you have not yet set up Python on your computer, you can execute this tutorial in your browser via <a class="reference external" href="https://colab.research.google.com/">Google Colab</a>. Click on the rocket in the top right corner and launch “Colab”. If that doesn’t work download the <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> file and import it in <a class="reference external" href="https://colab.research.google.com/">Google Colab</a>.</p>
<p>Then install the following packages by executing the following command in a Jupyter cell at the top of the notebook.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>!pip<span class="w"> </span>install<span class="w"> </span>pypsa<span class="w"> </span>pandas<span class="w"> </span>matplotlib
</pre></div>
</div>
</div>
<p>First things first! We need a few packages for this tutorial:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pypsa</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;bmh&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="prerequisites-handling-technology-data-and-costs">
<h2>Prerequisites: handling technology data and costs<a class="headerlink" href="#prerequisites-handling-technology-data-and-costs" title="Permalink to this headline">#</a></h2>
<p>We maintain a database (<a class="github reference external" href="https://github.com/PyPSA/technology-data">PyPSA/technology-data</a>) which collects assumptions and projections for energy system technologies (such as costs, efficiencies, lifetimes, etc.) for given years, which we can load into a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>. This requires some pre-processing to load (e.g. converting units, setting defaults, re-arranging dimensions):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year</span> <span class="o">=</span> <span class="mi">2030</span>
<span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://raw.githubusercontent.com/PyPSA/technology-data/master/outputs/costs_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">.csv&quot;</span>
<span class="n">costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">costs</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;/kW&quot;</span><span class="p">),</span> <span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">1e3</span>
<span class="n">costs</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/kW&quot;</span><span class="p">,</span> <span class="s2">&quot;/MW&quot;</span><span class="p">)</span>

<span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;FOM&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;VOM&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;efficiency&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;fuel&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;investment&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;lifetime&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="s2">&quot;CO2 intensity&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;discount rate&quot;</span><span class="p">:</span> <span class="mf">0.07</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">costs</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>

<span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;OCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel&quot;</span><span class="p">]</span>
<span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;CCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel&quot;</span><span class="p">]</span>
<span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;OCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;CO2 intensity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;CO2 intensity&quot;</span><span class="p">]</span>
<span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;CCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;CO2 intensity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;CO2 intensity&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s also write a small utility function that calculates the <strong>annuity</strong> to annualise investment costs. The formula is</p>
<div class="math notranslate nohighlight">
\[
a(r, n) = \frac{r}{1-(1+r)^{-n}}
\]</div>
<p>where <span class="math notranslate nohighlight">\(r\)</span> is the discount rate and <span class="math notranslate nohighlight">\(n\)</span> is the lifetime.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">annuity</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">r</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annuity</span><span class="p">(</span><span class="mf">0.07</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.09439292574325567
</pre></div>
</div>
</div>
</div>
<p>Based on this, we can calculate the short-term marginal generation costs (STMGC, €/MWh):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">costs</span><span class="p">[</span><span class="s2">&quot;marginal_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">costs</span><span class="p">[</span><span class="s2">&quot;VOM&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">costs</span><span class="p">[</span><span class="s2">&quot;fuel&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">costs</span><span class="p">[</span><span class="s2">&quot;efficiency&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>and the annualised investment costs (<code class="docutils literal notranslate"><span class="pre">capital_cost</span></code> in PyPSA terms, €/MW/a):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annuity</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">annuity</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;discount rate&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;lifetime&quot;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">costs</span><span class="p">[</span><span class="s2">&quot;capital_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">annuity</span> <span class="o">+</span> <span class="n">costs</span><span class="p">[</span><span class="s2">&quot;FOM&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">costs</span><span class="p">[</span><span class="s2">&quot;investment&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="loading-time-series-data">
<h2>Loading time series data<a class="headerlink" href="#loading-time-series-data" title="Permalink to this headline">#</a></h2>
<p>We are also going to need some time series for wind, solar and load. For now, we are going to recycle the time series we used at the beginning of the course. They are given for Germany in the year 2015.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://tubcloud.tu-berlin.de/s/pKttFadrbTKSJKF/download/time-series-lecture-2.csv&quot;</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>load</th>
      <th>onwind</th>
      <th>offwind</th>
      <th>solar</th>
      <th>prices</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-01 00:00:00</th>
      <td>41.151</td>
      <td>0.1566</td>
      <td>0.7030</td>
      <td>0.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2015-01-01 01:00:00</th>
      <td>40.135</td>
      <td>0.1659</td>
      <td>0.6875</td>
      <td>0.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2015-01-01 02:00:00</th>
      <td>39.106</td>
      <td>0.1746</td>
      <td>0.6535</td>
      <td>0.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s convert the load time series from GW to MW, the base unit of PyPSA:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="o">.</span><span class="n">load</span> <span class="o">*=</span> <span class="mf">1e3</span>
</pre></div>
</div>
</div>
</div>
<p>We are also going to adapt the temporal resolution of the time series, e.g. sample only every other hour, to save some time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resolution</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2">H&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="simple-capacity-expansion-planning-example">
<h2>Simple capacity expansion planning example<a class="headerlink" href="#simple-capacity-expansion-planning-example" title="Permalink to this headline">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See also <a class="reference external" href="https://model.energy">https://model.energy</a>.</p>
</div>
<p><strong>In this tutorial, we want to build a replica of <a class="reference external" href="https://model.energy">model.energy</a>.</strong> This tool calculates the cost of meeting a constant electricity demand from a combination of wind power, solar power and storage for different regions of the world.</p>
<p>We deviate from <a class="reference external" href="https://model.energy">model.energy</a> by including offshore wind generation and electricity demand profiles rather than a constant electricity demand. Also, we are going to start with Germany only. You can adapt the code to other countries as an exercise.</p>
<section id="model-initialisation">
<h3>Model Initialisation<a class="headerlink" href="#model-initialisation" title="Permalink to this headline">#</a></h3>
<p>For building the model, we start again by initialising an empty network.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="n">pypsa</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we add a single bus…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;Bus&quot;</span><span class="p">,</span> <span class="s2">&quot;electricity&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>…and tell the <code class="docutils literal notranslate"><span class="pre">pypsa.Network</span></code> object <code class="docutils literal notranslate"><span class="pre">n</span></code> what the snapshots of the model will be using the utility function <code class="docutils literal notranslate"><span class="pre">n.set_snapshots()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">set_snapshots</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">snapshots</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatetimeIndex([&#39;2015-01-01 00:00:00&#39;, &#39;2015-01-01 04:00:00&#39;,
               &#39;2015-01-01 08:00:00&#39;, &#39;2015-01-01 12:00:00&#39;,
               &#39;2015-01-01 16:00:00&#39;, &#39;2015-01-01 20:00:00&#39;,
               &#39;2015-01-02 00:00:00&#39;, &#39;2015-01-02 04:00:00&#39;,
               &#39;2015-01-02 08:00:00&#39;, &#39;2015-01-02 12:00:00&#39;,
               ...
               &#39;2015-12-30 08:00:00&#39;, &#39;2015-12-30 12:00:00&#39;,
               &#39;2015-12-30 16:00:00&#39;, &#39;2015-12-30 20:00:00&#39;,
               &#39;2015-12-31 00:00:00&#39;, &#39;2015-12-31 04:00:00&#39;,
               &#39;2015-12-31 08:00:00&#39;, &#39;2015-12-31 12:00:00&#39;,
               &#39;2015-12-31 16:00:00&#39;, &#39;2015-12-31 20:00:00&#39;],
              dtype=&#39;datetime64[ns]&#39;, name=&#39;snapshot&#39;, length=2190, freq=&#39;4H&#39;)
</pre></div>
</div>
</div>
</div>
<p>The weighting of the snapshots (e.g. how many hours they represent, see <span class="math notranslate nohighlight">\(w_t\)</span> in problem formulation above) can be set in <code class="docutils literal notranslate"><span class="pre">n.snapshot_weightings</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>objective</th>
      <th>stores</th>
      <th>generators</th>
    </tr>
    <tr>
      <th>snapshot</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-01 00:00:00</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2015-01-01 04:00:00</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2015-01-01 08:00:00</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">resolution</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>objective</th>
      <th>stores</th>
      <th>generators</th>
    </tr>
    <tr>
      <th>snapshot</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-01 00:00:00</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2015-01-01 04:00:00</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2015-01-01 08:00:00</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="adding-components">
<h3>Adding Components<a class="headerlink" href="#adding-components" title="Permalink to this headline">#</a></h3>
<p>Then, we add all the technologies we are going to include as carriers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carriers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;onwind&quot;</span><span class="p">,</span> <span class="s2">&quot;offwind&quot;</span><span class="p">,</span> <span class="s2">&quot;solar&quot;</span><span class="p">,</span> <span class="s2">&quot;OCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;hydrogen storage underground&quot;</span><span class="p">,</span> <span class="s2">&quot;battery storage&quot;</span><span class="p">]</span>

<span class="n">n</span><span class="o">.</span><span class="n">madd</span><span class="p">(</span>
    <span class="s2">&quot;Carrier&quot;</span><span class="p">,</span>
    <span class="n">carriers</span><span class="p">,</span> 
    <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dodgerblue&quot;</span><span class="p">,</span> <span class="s2">&quot;aquamarine&quot;</span><span class="p">,</span> <span class="s2">&quot;gold&quot;</span><span class="p">,</span> <span class="s2">&quot;indianred&quot;</span><span class="p">,</span> <span class="s2">&quot;magenta&quot;</span><span class="p">,</span> <span class="s2">&quot;yellowgreen&quot;</span><span class="p">],</span>
    <span class="n">co2_emissions</span><span class="o">=</span><span class="p">[</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;CO2 intensity&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">carriers</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;onwind&#39;, &#39;offwind&#39;, &#39;solar&#39;, &#39;OCGT&#39;, &#39;hydrogen storage underground&#39;,
       &#39;battery storage&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>Next, we add the demand time series to the model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="s2">&quot;Load&quot;</span><span class="p">,</span>
    <span class="s2">&quot;demand&quot;</span><span class="p">,</span>
    <span class="n">bus</span><span class="o">=</span><span class="s2">&quot;electricity&quot;</span><span class="p">,</span>
    <span class="n">p_set</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">load</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s have a check whether the data was read-in correctly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;MW&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;snapshot&#39;, ylabel=&#39;MW&#39;&gt;
</pre></div>
</div>
<img alt="_images/3e58c9077f15b05fdff8bce736620c594b1990cb157a523708adc8c64c501d5f.png" src="_images/3e58c9077f15b05fdff8bce736620c594b1990cb157a523708adc8c64c501d5f.png" />
</div>
</div>
<p>We are going to add one dispatchable generation technology to the model. This is an open-cycle gas turbine (OCGT) with CO<span class="math notranslate nohighlight">\(_2\)</span> emissions of 0.2 t/MWh<span class="math notranslate nohighlight">\(_{th}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="s2">&quot;Generator&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OCGT&quot;</span><span class="p">,</span>
    <span class="n">bus</span><span class="o">=</span><span class="s1">&#39;electricity&#39;</span><span class="p">,</span>
    <span class="n">carrier</span><span class="o">=</span><span class="s2">&quot;OCGT&quot;</span><span class="p">,</span>
    <span class="n">capital_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;OCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">],</span>
    <span class="n">marginal_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;OCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;marginal_cost&quot;</span><span class="p">],</span>
    <span class="n">efficiency</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;OCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
    <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Adding the variable renewable generators works almost identically, but we also need to supply the capacity factors to the model via the attribute <code class="docutils literal notranslate"><span class="pre">p_max_pu</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">tech</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;onwind&quot;</span><span class="p">,</span> <span class="s2">&quot;offwind&quot;</span><span class="p">,</span> <span class="s2">&quot;solar&quot;</span><span class="p">]:</span>
    <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;Generator&quot;</span><span class="p">,</span>
        <span class="n">tech</span><span class="p">,</span>
        <span class="n">bus</span><span class="o">=</span><span class="s1">&#39;electricity&#39;</span><span class="p">,</span>
        <span class="n">carrier</span><span class="o">=</span><span class="n">tech</span><span class="p">,</span>
        <span class="n">p_max_pu</span><span class="o">=</span><span class="n">ts</span><span class="p">[</span><span class="n">tech</span><span class="p">],</span>
        <span class="n">capital_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">tech</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">],</span>
        <span class="n">marginal_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">tech</span><span class="p">,</span> <span class="s2">&quot;marginal_cost&quot;</span><span class="p">],</span>
        <span class="n">efficiency</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">tech</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
        <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>So let’s make sure the capacity factors are read-in correctly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p_max_pu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;2015-03&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;CF&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;snapshot&#39;, ylabel=&#39;CF&#39;&gt;
</pre></div>
</div>
<img alt="_images/b7d1ff59beafecea398d955be801221158f6d9455e99b6bf91243f7d0da09e48.png" src="_images/b7d1ff59beafecea398d955be801221158f6d9455e99b6bf91243f7d0da09e48.png" />
</div>
</div>
</section>
<section id="model-run">
<h3>Model Run<a class="headerlink" href="#model-run" title="Permalink to this headline">#</a></h3>
<p>Then, we can already solve the model for the first time. At this stage, the model does not have any storage or emission limits implemented. It’s going to look for the least-cost combination of variable renewables and the gas turbine to supply demand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

INFO:linopy.model: Solve linear problem using Cbc solver
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.io: Writing time: 0.12s
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 8764 primals, 19714 duals
Objective: 2.75e+10
Solver model: not available
Solver message: Optimal - objective value 27532289223.69232178
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Welcome to the CBC MILP Solver 
Version: 2.10.10 
Build Date: Apr 19 2023 

command line - cbc -printingOptions all -import /tmp/linopy-problem-hoh53a0q.lp -solve -solu /tmp/linopy-solve-ym3w7i6x.sol (default strategy 1)
Option for printingOptions changed from normal to all
Presolve 9900 (-9814) rows, 7714 (-1050) columns and 23130 (-10864) elements
Perturbing problem by 0.001% of 231.67376 - largest nonzero change 0.00033155867 ( 6.8960834%) - largest zero change 0
0  Obj 0 Primal inf 1.6937954e+08 (2190)
273  Obj 99289248 Primal inf 1.6143953e+08 (2190)
546  Obj 1.8929297e+08 Primal inf 1.5545163e+08 (2190)
819  Obj 3.053471e+08 Primal inf 1.4853111e+08 (2190)
1092  Obj 4.3229077e+08 Primal inf 1.4050834e+08 (2190)
1365  Obj 5.7839109e+08 Primal inf 1.3256861e+08 (2190)
1638  Obj 7.44638e+08 Primal inf 1.2422418e+08 (2190)
1911  Obj 9.9448681e+08 Primal inf 1.1699429e+08 (2190)
2184  Obj 4.349048e+09 Primal inf 1.0442117e+08 (2109)
2457  Obj 4.7128424e+09 Primal inf 95575591 (2085)
2730  Obj 5.1032609e+09 Primal inf 88029222 (2054)
3003  Obj 5.7075703e+09 Primal inf 79560489 (2008)
3276  Obj 6.5109548e+09 Primal inf 69850183 (1942)
3549  Obj 7.2877291e+09 Primal inf 63779648 (1875)
3822  Obj 8.36732e+09 Primal inf 57114484 (1788)
4095  Obj 9.4206961e+09 Primal inf 53055330 (1706)
4368  Obj 1.0666399e+10 Primal inf 47537061 (1605)
4641  Obj 1.1806111e+10 Primal inf 44671707 (1518)
4914  Obj 1.3092257e+10 Primal inf 40713437 (1421)
5187  Obj 1.441374e+10 Primal inf 37766533 (1323)
5460  Obj 1.5887738e+10 Primal inf 32325713 (1211)
5733  Obj 1.7303577e+10 Primal inf 28297766 (1111)
6006  Obj 1.8682133e+10 Primal inf 25535904 (1006)
6279  Obj 2.0051625e+10 Primal inf 21659695 (899)
6552  Obj 2.1669797e+10 Primal inf 17322881 (786)
6825  Obj 2.3269216e+10 Primal inf 14052672 (670)
7098  Obj 2.4817852e+10 Primal inf 7484725 (415)
7371  Obj 2.6399462e+10 Primal inf 3546329.1 (263)
7644  Obj 2.7530103e+10 Primal inf 43091.304 (79)
7708  Obj 2.7532295e+10
Optimal - objective value 2.7532289e+10
After Postsolve, objective 2.7532289e+10, infeasibilities - dual 0 (0), primal 0 (0)
Optimal objective 2.753228922e+10 - 7708 iterations time 0.182, Presolve 0.02
Total time (CPU seconds):       0.28   (Wallclock seconds):       0.24
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;ok&#39;, &#39;optimal&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-evaluation">
<h3>Model Evaluation<a class="headerlink" href="#model-evaluation" title="Permalink to this headline">#</a></h3>
<p>The total system cost in billion Euros per year:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">objective</span> <span class="o">/</span> <span class="mf">1e9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>27.53228922369232
</pre></div>
</div>
</div>
</div>
<p>The optimised capacities in GW:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom_opt</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span> <span class="c1"># GW</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generator
OCGT       70.182246
onwind      0.000000
offwind    42.399533
solar      82.323420
Name: p_nom_opt, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>The total energy generation by technology in GW:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">generators</span> <span class="o">@</span> <span class="n">n</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># TWh</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generator
OCGT       258.400419
onwind       0.000000
offwind    131.445301
solar       89.080020
Name: generators, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>While we get the objective value through <code class="docutils literal notranslate"><span class="pre">n.objective</span></code>, in many cases we want to know how the costs are distributed across the technologies</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">opex</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">generators</span> <span class="o">@</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">marginal_cost</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># M€/a</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">capex</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom_opt</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">capital_cost</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># M€/a</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">capex</span> <span class="o">+</span> <span class="n">opex</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generator
OCGT       16995.624257
onwind         0.000000
offwind     6707.003125
solar       3829.661877
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>If you have the newest version of PyPSA installed, you can also run the following to determine the total system cost by technology:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">capex</span><span class="p">()</span> <span class="o">+</span> <span class="n">n</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">opex</span><span class="p">(</span><span class="n">aggregate_time</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           carrier
Generator  OCGT       16995.624257
           offwind     6707.003125
           onwind         0.000000
           solar       3829.661877
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Possibly, we are also interested in the total emissions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">emissions</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p</span> <span class="o">/</span> <span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">efficiency</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">carrier</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">carriers</span><span class="o">.</span><span class="n">co2_emissions</span><span class="p">)</span> <span class="c1"># t/h</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">generators</span> <span class="o">@</span> <span class="n">emissions</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># Mt</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>126.04898507491518
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-optimal-dispatch">
<h3>Plotting Optimal Dispatch<a class="headerlink" href="#plotting-optimal-dispatch" title="Permalink to this headline">#</a></h3>
<p>This function takes the network object <code class="docutils literal notranslate"><span class="pre">n</span></code> as an argument and, optionally, a time frame. We want to plot the load time series, and stacked area charts for electricity feed-in and storage charging. Technologies should be coloured by their color defined in <code class="docutils literal notranslate"><span class="pre">n.carriers</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_dispatch</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="s2">&quot;2015-07&quot;</span><span class="p">):</span>
    
    <span class="n">p_by_carrier</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">carrier</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">sto</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">storage_units_t</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">carrier</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span>
        <span class="n">p_by_carrier</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">p_by_carrier</span><span class="p">,</span> <span class="n">sto</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    
    <span class="n">color</span> <span class="o">=</span> <span class="n">p_by_carrier</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">carriers</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
    
    <span class="n">p_by_carrier</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p_by_carrier</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">area</span><span class="p">(</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="n">charge</span> <span class="o">=</span> <span class="n">p_by_carrier</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p_by_carrier</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">time</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">charge</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>

        <span class="n">charge</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">area</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">charge</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">carriers</span><span class="o">.</span><span class="n">color</span><span class="p">),</span>
        <span class="p">)</span>
    
    <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;GW&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Oje, that was complicated. Let’s test it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_dispatch</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d3feabc3b11fb999dc5ed813877bea98c5213598d6fe2a78507a545d8861c7eb.png" src="_images/d3feabc3b11fb999dc5ed813877bea98c5213598d6fe2a78507a545d8861c7eb.png" />
</div>
</div>
</section>
</section>
<section id="adding-storage-units">
<h2>Adding Storage Units<a class="headerlink" href="#adding-storage-units" title="Permalink to this headline">#</a></h2>
<p>Alright, but there are a few important components missing for a system with high shares of renewables? What about short-term storage options (e.g. batteries) and long-term storage options (e.g. hydrogen storage)? Let’s add them too.</p>
<p>First, the battery storage. We are going to assume a fixed energy-to-power ratio of 6 hours, i.e. if fully charged, the battery can discharge at full capacity for 6 hours.
For the capital cost, we have to factor in both the capacity and energy cost of the storage. We are also going to enforce a cyclic state-of-charge condition, i.e. the state of charge
at the beginning of the optimisation period must equal the final state of charge.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="s2">&quot;StorageUnit&quot;</span><span class="p">,</span>
    <span class="s2">&quot;battery storage&quot;</span><span class="p">,</span>
    <span class="n">bus</span><span class="o">=</span><span class="s1">&#39;electricity&#39;</span><span class="p">,</span>
    <span class="n">carrier</span><span class="o">=</span><span class="s2">&quot;battery storage&quot;</span><span class="p">,</span>
    <span class="n">max_hours</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">capital_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;battery inverter&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;battery storage&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">],</span>
    <span class="n">efficiency_store</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;battery inverter&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
    <span class="n">efficiency_dispatch</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;battery inverter&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
    <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cyclic_state_of_charge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Second, the hydrogen storage. This one is composed of an electrolysis to convert electricity to hydrogen, a fuel cell to re-convert hydrogen to electricity and underground storage (e.g. in salt caverns). We assume an energy-to-power ratio of 168 hours, such that this type of storage can be used for weekly balancing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">capital_costs</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;electrolysis&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">]</span> <span class="o">+</span>
    <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;fuel cell&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">]</span> <span class="o">+</span>
    <span class="mi">168</span> <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;hydrogen storage underground&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="s2">&quot;StorageUnit&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hydrogen storage underground&quot;</span><span class="p">,</span>
    <span class="n">bus</span><span class="o">=</span><span class="s2">&quot;electricity&quot;</span><span class="p">,</span>
    <span class="n">carrier</span><span class="o">=</span><span class="s2">&quot;hydrogen storage underground&quot;</span><span class="p">,</span>
    <span class="n">max_hours</span><span class="o">=</span><span class="mi">168</span><span class="p">,</span>
    <span class="n">capital_cost</span><span class="o">=</span><span class="n">capital_costs</span><span class="p">,</span>
    <span class="n">efficiency_store</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;electrolysis&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
    <span class="n">efficiency_dispatch</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;fuel cell&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
    <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cyclic_state_of_charge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Ok, lets run the again, now with storage, and see what’s changed.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

INFO:linopy.model: Solve linear problem using Cbc solver
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.io:Writing objective.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.:   0%|          | 0/14 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.:  57%|█████▋    | 8/14 [00:00&lt;00:00, 68.15it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.: 100%|██████████| 14/14 [00:00&lt;00:00, 56.06it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing variables.:   0%|          | 0/7 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing variables.: 100%|██████████| 7/7 [00:00&lt;00:00, 184.06it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.io: Writing time: 0.33s
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 21906 primals, 50376 duals
Objective: 2.75e+10
Solver model: not available
Solver message: Optimal - objective value 27532289223.69231415
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Welcome to the CBC MILP Solver 
Version: 2.10.10 
Build Date: Apr 19 2023 

command line - cbc -printingOptions all -import /tmp/linopy-problem-b5po_8hd.lp -solve -solu /tmp/linopy-solve-v54xz1sy.sol (default strategy 1)
Option for printingOptions changed from normal to all
Presolve 27420 (-22956) rows, 20856 (-1050) columns and 75690 (-24006) elements
Perturbing problem by 0.001% of 232.80852 - largest nonzero change 0.00033269303 ( 6.8859498%) - largest zero change 0.0003312509
0  Obj 0 Primal inf 1.7299319e+08 (2190)
362  Obj 1533.1194 Primal inf 2.0311713e+08 (2526)
724  Obj 57854.02 Primal inf 2.3613949e+08 (2828)
1086  Obj 2.7945624e+09 Primal inf 2.6149483e+08 (3052)
1448  Obj 3.028221e+09 Primal inf 2.7838941e+08 (3215)
1810  Obj 3.2790364e+09 Primal inf 2.8919513e+08 (3325)
2172  Obj 3.5661458e+09 Primal inf 2.9340495e+08 (3404)
2534  Obj 3.8615063e+09 Primal inf 3.0078977e+08 (3476)
2896  Obj 4.1368103e+09 Primal inf 3.0506132e+08 (3523)
3258  Obj 4.35539e+09 Primal inf 3.0659227e+08 (3566)
3620  Obj 4.5115102e+09 Primal inf 2.9965418e+08 (3578)
3982  Obj 4.7012691e+09 Primal inf 3.0619855e+08 (3619)
4344  Obj 4.929369e+09 Primal inf 2.9669713e+08 (3640)
4706  Obj 5.0927827e+09 Primal inf 2.9536911e+08 (3672)
5068  Obj 5.436143e+09 Primal inf 2.8590574e+08 (3668)
5430  Obj 5.7259353e+09 Primal inf 2.794528e+08 (3668)
5792  Obj 6.0526507e+09 Primal inf 2.7091083e+08 (3659)
6154  Obj 6.1922592e+09 Primal inf 2.6075623e+08 (3640)
6516  Obj 6.5929942e+09 Primal inf 2.4730128e+08 (3596)
6878  Obj 6.8999994e+09 Primal inf 2.3833123e+08 (3580)
7240  Obj 7.321848e+09 Primal inf 2.2978354e+08 (3521)
7602  Obj 7.5556003e+09 Primal inf 2.2398371e+08 (3471)
7964  Obj 8.0534511e+09 Primal inf 2.1426713e+08 (3430)
8326  Obj 8.3290574e+09 Primal inf 2.1103598e+08 (3397)
8688  Obj 8.5715647e+09 Primal inf 2.0470435e+08 (3363)
9050  Obj 9.085733e+09 Primal inf 1.9946535e+08 (3343)
9412  Obj 9.8510392e+09 Primal inf 1.9375142e+08 (3314)
9774  Obj 1.0396867e+10 Primal inf 1.8183844e+08 (3211)
10136  Obj 1.1231802e+10 Primal inf 1.6004685e+08 (3120)
10498  Obj 1.2052908e+10 Primal inf 1.525137e+08 (3072)
10860  Obj 1.3018317e+10 Primal inf 1.3788882e+08 (2962)
11222  Obj 1.3982347e+10 Primal inf 1.2776496e+08 (2834)
11584  Obj 1.5051631e+10 Primal inf 1.1522189e+08 (2716)
11946  Obj 1.5758807e+10 Primal inf 2.8470938e+08 (6283)
12308  Obj 1.6058239e+10 Primal inf 1.73256e+08 (4356)
12670  Obj 1.6343074e+10 Primal inf 1.9005439e+08 (4255)
13032  Obj 1.6518896e+10 Primal inf 3.5136232e+08 (6006)
13394  Obj 1.6914757e+10 Primal inf 2.9134601e+08 (4082)
13756  Obj 1.7480497e+10 Primal inf 3.0444203e+08 (4080)
14118  Obj 1.8204522e+10 Primal inf 3.135408e+08 (4147)
14480  Obj 1.8809472e+10 Primal inf 1.0702363e+09 (11295)
14842  Obj 1.9303471e+10 Primal inf 6.5665248e+08 (11047)
15204  Obj 1.9939625e+10 Primal inf 3.2504084e+08 (4012)
15566  Obj 2.0542191e+10 Primal inf 3.4631532e+08 (3963)
15928  Obj 2.1478996e+10 Primal inf 1.1717958e+08 (3476)
16290  Obj 2.2349618e+10 Primal inf 1.1173589e+08 (3440)
16652  Obj 2.3134886e+10 Primal inf 4.9250036e+08 (5642)
17014  Obj 2.368181e+10 Primal inf 2.6344083e+08 (3758)
17376  Obj 2.4246833e+10 Primal inf 2.6470794e+08 (3376)
17738  Obj 2.4847634e+10 Primal inf 3.7672411e+09 (16825)
18100  Obj 2.5309228e+10 Primal inf 9.5997994e+08 (4850)
18462  Obj 2.5795532e+10 Primal inf 1.6926277e+08 (4044)
18824  Obj 2.6370301e+10 Primal inf 9.3970491e+08 (5119)
19186  Obj 2.6749348e+10 Primal inf 2.0237103e+08 (4013)
19548  Obj 2.6825886e+10 Primal inf 45296715 (2235)
19910  Obj 2.6898838e+10 Primal inf 84419260 (4576)
20272  Obj 2.7093344e+10 Primal inf 25114397 (2988)
20634  Obj 2.7409537e+10 Primal inf 11748081 (856)
20996  Obj 2.7520857e+10 Primal inf 401656.68 (165)
21174  Obj 2.7532295e+10
Optimal - objective value 2.7532289e+10
After Postsolve, objective 2.7532289e+10, infeasibilities - dual 0 (0), primal 0 (0)
Optimal objective 2.753228922e+10 - 21174 iterations time 2.142, Presolve 0.04
Total time (CPU seconds):       2.38   (Wallclock seconds):       2.35
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;ok&#39;, &#39;optimal&#39;)
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom_opt</span> <span class="c1"># MW</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generator
OCGT       70182.246
onwind         0.000
offwind    42399.533
solar      82323.420
Name: p_nom_opt, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">p_nom_opt</span> <span class="c1"># MW</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>StorageUnit
battery storage                 0.0
hydrogen storage underground    0.0
Name: p_nom_opt, dtype: float64
</pre></div>
</div>
</div>
</div>
<p><strong>Nothing!</strong> The objective value is the same, and no storage is built.</p>
<section id="adding-emission-limits">
<h3>Adding emission limits<a class="headerlink" href="#adding-emission-limits" title="Permalink to this headline">#</a></h3>
<p>The gas power plant offers sufficient and cheap enough backup capacity to run in periods of low wind and solar generation. But what happens if this source of flexibility disappears. Let’s model a 100% renewable electricity system by adding a CO<span class="math notranslate nohighlight">\(_2\)</span> emission limit as global constraint:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="s2">&quot;GlobalConstraint&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CO2Limit&quot;</span><span class="p">,</span>
    <span class="n">carrier_attribute</span><span class="o">=</span><span class="s2">&quot;co2_emissions&quot;</span><span class="p">,</span>
    <span class="n">sense</span><span class="o">=</span><span class="s2">&quot;&lt;=&quot;</span><span class="p">,</span>
    <span class="n">constant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>When we run the model now…</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

INFO:linopy.model: Solve linear problem using Cbc solver
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.io:Writing objective.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.:   0%|          | 0/15 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.:  53%|█████▎    | 8/15 [00:00&lt;00:00, 68.18it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.: 100%|██████████| 15/15 [00:00&lt;00:00, 56.71it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.: 100%|██████████| 15/15 [00:00&lt;00:00, 58.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing variables.:   0%|          | 0/7 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing variables.: 100%|██████████| 7/7 [00:00&lt;00:00, 181.45it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.io: Writing time: 0.34s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Welcome to the CBC MILP Solver 
Version: 2.10.10 
Build Date: Apr 19 2023 

command line - cbc -printingOptions all -import /tmp/linopy-problem-q8cx2o6n.lp -solve -solu /tmp/linopy-solve-wb4y2_ww.sol (default strategy 1)
Option for printingOptions changed from normal to all
Presolve 25230 (-25147) rows, 18665 (-3241) columns and 69120 (-32766) elements
Perturbing problem by 0.001% of 232.80852 - largest nonzero change 0.00032089483 ( 6.9617437%) - largest zero change 0.00032065496
0  Obj 0 Primal inf 1.7299319e+08 (2190)
351  Obj 1493.2063 Primal inf 2.019611e+08 (2516)
702  Obj 19768.495 Primal inf 2.3707684e+08 (2831)
1053  Obj 1.1549821e+10 Primal inf 1.9381022e+08 (2257)
1404  Obj 1.7620182e+10 Primal inf 2.917228e+08 (3144)
1755  Obj 1.762027e+10 Primal inf 3.740087e+08 (3204)
2106  Obj 1.7623518e+10 Primal inf 3.2041701e+08 (3248)
2457  Obj 1.7623677e+10 Primal inf 4.5217242e+08 (3293)
2808  Obj 1.7624126e+10 Primal inf 3.3797596e+08 (3347)
3159  Obj 1.7629318e+10 Primal inf 4.2297751e+08 (3333)
3510  Obj 1.7629381e+10 Primal inf 7.4586056e+08 (3414)
3861  Obj 1.7629617e+10 Primal inf 5.1214998e+08 (3522)
4212  Obj 1.7629729e+10 Primal inf 4.7389473e+08 (3592)
4563  Obj 1.7629895e+10 Primal inf 4.9994957e+08 (3569)
4914  Obj 1.7630331e+10 Primal inf 5.0752938e+08 (3756)
5265  Obj 1.7644643e+10 Primal inf 1.1143298e+09 (3729)
5616  Obj 1.7678866e+10 Primal inf 4.7464905e+08 (3774)
5967  Obj 1.7702582e+10 Primal inf 6.3591934e+08 (3811)
6318  Obj 1.7708007e+10 Primal inf 6.6661095e+08 (3839)
6669  Obj 1.7766744e+10 Primal inf 6.514763e+08 (3843)
7020  Obj 2.7055127e+10 Primal inf 1.5080934e+09 (3819)
7371  Obj 2.7085805e+10 Primal inf 5.1651111e+08 (3804)
7722  Obj 4.0875435e+10 Primal inf 4.018669e+08 (3934)
8073  Obj 4.0875558e+10 Primal inf 4.4312166e+08 (4060)
8424  Obj 4.0875725e+10 Primal inf 4.3704163e+08 (4165)
8775  Obj 4.0877747e+10 Primal inf 4.4507561e+08 (4263)
9126  Obj 4.4321005e+10 Primal inf 3.8640415e+08 (3929)
9477  Obj 4.4321527e+10 Primal inf 4.468353e+08 (4056)
9828  Obj 4.4322209e+10 Primal inf 3.7719085e+08 (3972)
10179  Obj 4.4322389e+10 Primal inf 3.3567797e+08 (3842)
10530  Obj 4.4322693e+10 Primal inf 3.4618779e+08 (3822)
10881  Obj 4.432282e+10 Primal inf 5.0675272e+08 (3925)
11232  Obj 4.4518679e+10 Primal inf 4.2314349e+08 (3872)
11583  Obj 4.4535383e+10 Primal inf 4.0876152e+08 (3879)
11934  Obj 4.4535746e+10 Primal inf 4.0183276e+08 (3864)
12285  Obj 4.4536009e+10 Primal inf 3.6420439e+08 (3886)
12636  Obj 4.4536233e+10 Primal inf 4.3141423e+08 (4005)
12987  Obj 4.4536551e+10 Primal inf 7.9547182e+08 (3989)
13338  Obj 4.454034e+10 Primal inf 4.2950001e+08 (3851)
13689  Obj 4.4541205e+10 Primal inf 6.9347967e+08 (3908)
14040  Obj 4.5304663e+10 Primal inf 2.8458908e+08 (3602)
14391  Obj 5.1370715e+10 Primal inf 2.0345449e+08 (3001)
14742  Obj 5.2187862e+10 Primal inf 8.4987245e+08 (9420)
15093  Obj 5.2239632e+10 Primal inf 8.1551123e+08 (9591)
15444  Obj 5.2338613e+10 Primal inf 1.0257012e+09 (9821)
15795  Obj 5.560809e+10 Primal inf 7.9763653e+08 (5430)
16146  Obj 5.722518e+10 Primal inf 97418274 (2496)
16497  Obj 5.8055778e+10 Primal inf 6.2779532e+08 (8949)
16848  Obj 5.9242602e+10 Primal inf 2.9036167e+09 (9311)
17199  Obj 6.0941764e+10 Primal inf 1.1963173e+08 (2570)
17550  Obj 6.1667e+10 Primal inf 2.5283118e+08 (2904)
17901  Obj 6.1683882e+10 Primal inf 5.4950137e+08 (3219)
18252  Obj 6.2086071e+10 Primal inf 2.1176798e+08 (3055)
18603  Obj 6.2208168e+10 Primal inf 3.7587043e+08 (3317)
18949  Obj 6.2273584e+10 Primal inf 3.888203e+08 (3241)
19300  Obj 6.3000287e+10 Primal inf 2.4756172e+09 (6560)
19651  Obj 6.3850263e+10 Primal inf 2.630614e+08 (3240)
20002  Obj 6.4030173e+10 Primal inf 2.7599938e+08 (3130)
20353  Obj 6.4493377e+10 Primal inf 1.9884207e+08 (3014)
20704  Obj 6.5112443e+10 Primal inf 37925072 (1486)
21055  Obj 6.5534463e+10 Primal inf 29320962 (1234)
21406  Obj 6.5557353e+10 Primal inf 20296656 (999)
21757  Obj 6.5653553e+10 Primal inf 7594346.3 (757)
22108  Obj 6.5701993e+10 Primal inf 3442385.5 (651)
22459  Obj 6.5800795e+10 Primal inf 24074699 (462)
22696  Obj 6.5813275e+10
Optimal - objective value 6.581318e+10
After Postsolve, objective 6.581318e+10, infeasibilities - dual 0 (0), primal 0 (0)
Optimal objective 6.581318003e+10 - 22696 iterations time 4.522, Presolve 0.04
Total time (CPU seconds):       4.74   (Wallclock seconds):       4.75
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 21906 primals, 50377 duals
Objective: 6.58e+10
Solver model: not available
Solver message: Optimal - objective value 65813180032.18479919
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;ok&#39;, &#39;optimal&#39;)
</pre></div>
</div>
</div>
</details>
</div>
<p>…and inspect the capacities built…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom_opt</span> <span class="c1"># MW</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generator
OCGT            0.000
onwind     225963.170
offwind     76925.172
solar      248437.260
Name: p_nom_opt, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">p_nom_opt</span> <span class="c1"># MW</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>StorageUnit
battery storage                 34106.690
hydrogen storage underground    60603.643
Name: p_nom_opt, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">p_nom_opt</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">max_hours</span> <span class="c1"># GWh</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>StorageUnit
battery storage                   204.640140
hydrogen storage underground    10181.412024
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>… we see quite a bit of storage. So how does the optimised dispatch of the system look like?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_dispatch</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/micromamba-root/envs/esm/lib/python3.11/site-packages/pandas/plotting/_matplotlib/core.py:1598: UserWarning:

Attempting to set identical low and high ylims makes transformation singular; automatically expanding.
</pre></div>
</div>
<img alt="_images/3f5897d122f5da10eac8e55f52d76bb7d19edbd8a8aa855c4afa7303d5033eee.png" src="_images/3f5897d122f5da10eac8e55f52d76bb7d19edbd8a8aa855c4afa7303d5033eee.png" />
</div>
</div>
<p>We are also keen to see what technologies constitute the largest cost components. For that we’re going to define a small helper function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">system_cost</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">tsc</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">capex</span><span class="p">()</span> <span class="o">+</span> <span class="n">n</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">opex</span><span class="p">(</span><span class="n">aggregate_time</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tsc</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># million €/a</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have an older PyPSA version, the statistics accessor might not be available and you may have to use this alternative, more complicated function with individual items for each cost component:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">system_cost</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">opex</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">generators</span> <span class="o">@</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">marginal_cost</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># M€/a</span>
    <span class="n">capex</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom_opt</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">capital_cost</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># M€/a</span>
    <span class="n">capex_storage</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">p_nom_opt</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">capital_cost</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># M€/a</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">opex</span><span class="p">,</span> <span class="n">capex</span><span class="p">,</span> <span class="n">capex_storage</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system_cost</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>carrier
OCGT                                0.000000
offwind                         12168.412647
onwind                          21803.629913
solar                           11557.206875
battery storage                  3289.077324
hydrogen storage underground    16994.853645
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>This series, we can then process into plots, e.g. a pie chart:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system_cost</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="_images/03fe2982e706988b4995ae53e361e2a8f93cdb768dc9681a18a298031538e22a.png" src="_images/03fe2982e706988b4995ae53e361e2a8f93cdb768dc9681a18a298031538e22a.png" />
</div>
</div>
<p>or use to compute the cost per unit of electricity consumed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demand</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">generators</span> <span class="o">@</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system_cost</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">*</span><span class="mf">1e6</span> <span class="o">/</span> <span class="n">demand</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>137.4183404801308
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Always consider, that the load data is given in units of power (MW) and if your resolution is not hourly, you need to multiply by the snapshot weighting to get the energy consumed!</p>
</div>
</section>
</section>
<section id="sensitivity-analysis">
<h2>Sensitivity Analysis<a class="headerlink" href="#sensitivity-analysis" title="Permalink to this headline">#</a></h2>
<p>Sensitivity analyses constitute a core activity of energy system modelling. Below, you can find sensitivity analyses regarding the</p>
<ol class="arabic simple">
<li><p>variation in allowed CO<span class="math notranslate nohighlight">\(_2\)</span> emissions</p></li>
<li><p>variation in solar overnight costs</p></li>
<li><p>variation in offshore wind potentials</p></li>
</ol>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sensitivity</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">co2</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span>
    <span class="n">n</span><span class="o">.</span><span class="n">global_constraints</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;CO2Limit&quot;</span><span class="p">,</span> <span class="s2">&quot;constant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">co2</span> <span class="o">*</span> <span class="mf">1e6</span>
    <span class="n">n</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span>
    <span class="n">sensitivity</span><span class="p">[</span><span class="n">co2</span><span class="p">]</span> <span class="o">=</span> <span class="n">system_cost</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

INFO:linopy.model: Solve linear problem using Cbc solver
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.io:Writing objective.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.:   0%|          | 0/15 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.:  53%|█████▎    | 8/15 [00:00&lt;00:00, 67.13it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.: 100%|██████████| 15/15 [00:00&lt;00:00, 55.89it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.: 100%|██████████| 15/15 [00:00&lt;00:00, 57.26it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing variables.:   0%|          | 0/7 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing variables.: 100%|██████████| 7/7 [00:00&lt;00:00, 184.67it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.io: Writing time: 0.34s
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 21906 primals, 50377 duals
Objective: 2.75e+10
Solver model: not available
Solver message: Optimal - objective value 27532289223.69231415
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Welcome to the CBC MILP Solver 
Version: 2.10.10 
Build Date: Apr 19 2023 

command line - cbc -printingOptions all -import /tmp/linopy-problem-8_frt_rl.lp -solve -solu /tmp/linopy-solve-2lmtd8e1.sol (default strategy 1)
Option for printingOptions changed from normal to all
Presolve 27421 (-22956) rows, 20856 (-1050) columns and 77880 (-24006) elements
Perturbing problem by 0.001% of 232.80852 - largest nonzero change 0.00033269303 ( 6.8859498%) - largest zero change 0.0003312509
0  Obj 0 Primal inf 1.7299319e+08 (2190)
362  Obj 1533.1194 Primal inf 2.0311713e+08 (2526)
724  Obj 57854.02 Primal inf 2.3613949e+08 (2828)
1086  Obj 2.7945624e+09 Primal inf 2.6149483e+08 (3052)
1448  Obj 3.028221e+09 Primal inf 2.7838941e+08 (3215)
1810  Obj 3.2790364e+09 Primal inf 2.8919513e+08 (3325)
2172  Obj 3.5661458e+09 Primal inf 2.9340495e+08 (3404)
2534  Obj 3.8615063e+09 Primal inf 3.0078977e+08 (3476)
2896  Obj 4.1368103e+09 Primal inf 3.0506132e+08 (3523)
3258  Obj 4.35539e+09 Primal inf 3.0659227e+08 (3566)
3620  Obj 4.5115102e+09 Primal inf 2.9965418e+08 (3578)
3982  Obj 4.7012691e+09 Primal inf 3.0619855e+08 (3619)
4344  Obj 4.929369e+09 Primal inf 2.9669713e+08 (3640)
4706  Obj 5.0927827e+09 Primal inf 2.9536911e+08 (3672)
5068  Obj 5.436143e+09 Primal inf 2.8590574e+08 (3668)
5430  Obj 5.7259353e+09 Primal inf 2.794528e+08 (3668)
5792  Obj 6.0526507e+09 Primal inf 2.7091083e+08 (3659)
6154  Obj 6.1922592e+09 Primal inf 2.6075623e+08 (3640)
6516  Obj 6.5929942e+09 Primal inf 2.4730128e+08 (3596)
6878  Obj 6.8999994e+09 Primal inf 2.3833123e+08 (3580)
7240  Obj 7.321848e+09 Primal inf 2.2978354e+08 (3521)
7602  Obj 7.5556003e+09 Primal inf 2.2398371e+08 (3471)
7964  Obj 8.0534511e+09 Primal inf 2.1426713e+08 (3430)
8326  Obj 8.3290574e+09 Primal inf 2.1103598e+08 (3397)
8688  Obj 8.5715647e+09 Primal inf 2.0470435e+08 (3363)
9050  Obj 9.085733e+09 Primal inf 1.9946535e+08 (3343)
9412  Obj 9.8510392e+09 Primal inf 1.9375142e+08 (3314)
9774  Obj 1.0396867e+10 Primal inf 1.8183844e+08 (3211)
10136  Obj 1.1231802e+10 Primal inf 1.6004685e+08 (3120)
10498  Obj 1.2052908e+10 Primal inf 1.525137e+08 (3072)
10860  Obj 1.3018317e+10 Primal inf 1.3788882e+08 (2962)
11222  Obj 1.3982347e+10 Primal inf 1.2776496e+08 (2834)
11584  Obj 1.5051631e+10 Primal inf 1.1522189e+08 (2716)
11946  Obj 1.5758807e+10 Primal inf 2.8470938e+08 (6283)
12308  Obj 1.6058239e+10 Primal inf 1.73256e+08 (4356)
12670  Obj 1.6343074e+10 Primal inf 1.9005439e+08 (4255)
13032  Obj 1.6518896e+10 Primal inf 3.5136232e+08 (6006)
13394  Obj 1.6914757e+10 Primal inf 2.9134601e+08 (4082)
13756  Obj 1.7480497e+10 Primal inf 3.0444203e+08 (4080)
14118  Obj 1.8204522e+10 Primal inf 3.1405383e+08 (4145)
14480  Obj 1.8809472e+10 Primal inf 1.0926059e+09 (11298)
14842  Obj 1.9304848e+10 Primal inf 2.3371545e+08 (4025)
15204  Obj 1.9900352e+10 Primal inf 6.0002038e+09 (11195)
15566  Obj 2.0333682e+10 Primal inf 1.3707095e+08 (10472)
15928  Obj 2.0607995e+10 Primal inf 1.5919249e+08 (4063)
16290  Obj 2.1742181e+10 Primal inf 3.1900747e+08 (4007)
16652  Obj 2.2731761e+10 Primal inf 3.8925361e+08 (4091)
17014  Obj 2.3726576e+10 Primal inf 1.058705e+08 (3349)
17376  Obj 2.3976541e+10 Primal inf 1.2450393e+08 (4443)
17738  Obj 2.4672868e+10 Primal inf 2.8953535e+09 (9786)
18100  Obj 2.5411014e+10 Primal inf 4.0616379e+08 (3355)
18462  Obj 2.5960218e+10 Primal inf 4.4814934e+09 (16678)
18824  Obj 2.6569949e+10 Primal inf 1.0859145e+09 (3718)
19186  Obj 2.6726753e+10 Primal inf 1.6716351e+09 (5847)
19548  Obj 2.6814302e+10 Primal inf 34121054 (2371)
19910  Obj 2.7025862e+10 Primal inf 2.7141968e+08 (9735)
20272  Obj 2.7343597e+10 Primal inf 6399664 (809)
20634  Obj 2.7439116e+10 Primal inf 2281471.9 (390)
20996  Obj 2.753219e+10 Primal inf 2645.4191 (27)
21013  Obj 2.7532295e+10
Optimal - objective value 2.7532289e+10
After Postsolve, objective 2.7532289e+10, infeasibilities - dual 0 (0), primal 0 (0)
Optimal objective 2.753228922e+10 - 21013 iterations time 2.112, Presolve 0.04
Total time (CPU seconds):       2.35   (Wallclock seconds):       2.35
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

INFO:linopy.model: Solve linear problem using Cbc solver
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.io:Writing objective.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.:   0%|          | 0/15 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.:  53%|█████▎    | 8/15 [00:00&lt;00:00, 69.02it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.: 100%|██████████| 15/15 [00:00&lt;00:00, 57.03it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.: 100%|██████████| 15/15 [00:00&lt;00:00, 58.47it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing variables.:   0%|          | 0/7 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing variables.: 100%|██████████| 7/7 [00:00&lt;00:00, 185.85it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.io: Writing time: 0.33s
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 21906 primals, 50377 duals
Objective: 2.79e+10
Solver model: not available
Solver message: Optimal - objective value 27888335402.39854813
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Welcome to the CBC MILP Solver 
Version: 2.10.10 
Build Date: Apr 19 2023 

command line - cbc -printingOptions all -import /tmp/linopy-problem-q7zz6bh5.lp -solve -solu /tmp/linopy-solve-jka38qrg.sol (default strategy 1)
Option for printingOptions changed from normal to all
Presolve 27421 (-22956) rows, 20856 (-1050) columns and 77880 (-24006) elements
Perturbing problem by 0.001% of 232.80852 - largest nonzero change 0.00033269303 ( 6.8859498%) - largest zero change 0.0003312509
0  Obj 0 Primal inf 1.7299319e+08 (2190)
362  Obj 1533.1194 Primal inf 2.0311713e+08 (2526)
724  Obj 57854.02 Primal inf 2.3613949e+08 (2828)
1086  Obj 2.7945624e+09 Primal inf 2.6149483e+08 (3052)
1448  Obj 3.028221e+09 Primal inf 2.7838941e+08 (3215)
1810  Obj 3.2790364e+09 Primal inf 2.8919513e+08 (3325)
2172  Obj 3.5661458e+09 Primal inf 2.9340495e+08 (3404)
2534  Obj 3.8615063e+09 Primal inf 3.0078977e+08 (3476)
2896  Obj 4.1368103e+09 Primal inf 3.0506132e+08 (3523)
3258  Obj 4.35539e+09 Primal inf 3.0659227e+08 (3566)
3620  Obj 4.5115102e+09 Primal inf 2.9965418e+08 (3578)
3982  Obj 4.7012691e+09 Primal inf 3.0619855e+08 (3619)
4344  Obj 4.929369e+09 Primal inf 2.9669713e+08 (3640)
4706  Obj 5.0927827e+09 Primal inf 2.9536911e+08 (3672)
5068  Obj 5.436143e+09 Primal inf 2.8590574e+08 (3668)
5430  Obj 5.7259353e+09 Primal inf 2.794528e+08 (3668)
5792  Obj 6.0526507e+09 Primal inf 2.7091083e+08 (3659)
6154  Obj 6.1922592e+09 Primal inf 2.6075623e+08 (3640)
6516  Obj 6.5929942e+09 Primal inf 2.4730128e+08 (3596)
6878  Obj 6.8999994e+09 Primal inf 2.3833123e+08 (3580)
7240  Obj 7.321848e+09 Primal inf 2.2978354e+08 (3521)
7602  Obj 7.5556003e+09 Primal inf 2.2398371e+08 (3471)
7964  Obj 8.0534511e+09 Primal inf 2.1426713e+08 (3430)
8326  Obj 8.3290574e+09 Primal inf 2.1103598e+08 (3397)
8688  Obj 8.5715647e+09 Primal inf 2.0470435e+08 (3363)
9050  Obj 9.085733e+09 Primal inf 1.9946535e+08 (3343)
9412  Obj 9.8510392e+09 Primal inf 1.9375142e+08 (3314)
9774  Obj 1.0396867e+10 Primal inf 1.8183844e+08 (3211)
10136  Obj 1.1231802e+10 Primal inf 1.6004685e+08 (3120)
10498  Obj 1.2052908e+10 Primal inf 1.525137e+08 (3072)
10860  Obj 1.3018317e+10 Primal inf 1.3788882e+08 (2962)
11222  Obj 1.3982347e+10 Primal inf 1.2904994e+08 (2835)
11584  Obj 1.466828e+10 Primal inf 1.4408635e+08 (4697)
11946  Obj 1.5225651e+10 Primal inf 1.4863842e+08 (4638)
12308  Obj 1.5343907e+10 Primal inf 1.8739454e+08 (4617)
12670  Obj 1.5921382e+10 Primal inf 2.1527756e+08 (4548)
13032  Obj 1.6124383e+10 Primal inf 2.4662282e+08 (4509)
13394  Obj 1.6688295e+10 Primal inf 2.9324339e+08 (4532)
13756  Obj 1.8464292e+10 Primal inf 3.0119727e+08 (4547)
14118  Obj 1.9806029e+10 Primal inf 2.0074334e+08 (3192)
14480  Obj 2.0798995e+10 Primal inf 4.088741e+08 (5559)
14842  Obj 2.1837681e+10 Primal inf 4.6387508e+08 (10370)
15204  Obj 2.24189e+10 Primal inf 4.1927085e+08 (5843)
15566  Obj 2.3304832e+10 Primal inf 88165745 (3967)
15928  Obj 2.4219445e+10 Primal inf 1.0386084e+08 (3693)
16290  Obj 2.4868165e+10 Primal inf 1.3021303e+09 (10086)
16652  Obj 2.5342226e+10 Primal inf 4.0383877e+09 (7549)
17014  Obj 2.5768246e+10 Primal inf 53074003 (2467)
17376  Obj 2.6137791e+10 Primal inf 4.9696697e+08 (8522)
17738  Obj 2.6440411e+10 Primal inf 46869489 (3331)
18100  Obj 2.6796819e+10 Primal inf 34701438 (9088)
18462  Obj 2.7072385e+10 Primal inf 1.9777097e+08 (8954)
18824  Obj 2.7240373e+10 Primal inf 40435308 (9018)
19186  Obj 2.7375909e+10 Primal inf 19487768 (2421)
19548  Obj 2.7452418e+10 Primal inf 51322550 (8387)
19910  Obj 2.7479952e+10 Primal inf 1.5107628e+08 (1921)
20272  Obj 2.7656287e+10 Primal inf 6559855.8 (2405)
20634  Obj 2.7721488e+10 Primal inf 95991651 (1979)
20996  Obj 2.7804831e+10 Primal inf 2313324.9 (1923)
21358  Obj 2.7863276e+10 Primal inf 1814775.6 (657)
21720  Obj 2.7883693e+10 Primal inf 72246.148 (244)
21846  Obj 2.7888341e+10
Optimal - objective value 2.7888335e+10
After Postsolve, objective 2.7888335e+10, infeasibilities - dual 0 (0), primal 0 (0)
Optimal objective 2.78883354e+10 - 21846 iterations time 8.742, Presolve 0.04
Total time (CPU seconds):       8.98   (Wallclock seconds):       8.97
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

INFO:linopy.model: Solve linear problem using Cbc solver
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.io:Writing objective.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.:   0%|          | 0/15 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.:  53%|█████▎    | 8/15 [00:00&lt;00:00, 68.81it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.: 100%|██████████| 15/15 [00:00&lt;00:00, 56.66it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.: 100%|██████████| 15/15 [00:00&lt;00:00, 58.14it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing variables.:   0%|          | 0/7 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing variables.: 100%|██████████| 7/7 [00:00&lt;00:00, 183.45it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.io: Writing time: 0.34s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Welcome to the CBC MILP Solver 
Version: 2.10.10 
Build Date: Apr 19 2023 

command line - cbc -printingOptions all -import /tmp/linopy-problem-jxvjwmvs.lp -solve -solu /tmp/linopy-solve-d1u3d09o.sol (default strategy 1)
Option for printingOptions changed from normal to all
Presolve 27421 (-22956) rows, 20856 (-1050) columns and 77880 (-24006) elements
Perturbing problem by 0.001% of 232.80852 - largest nonzero change 0.00033269303 ( 6.8859498%) - largest zero change 0.0003312509
0  Obj 0 Primal inf 1.7299319e+08 (2190)
362  Obj 1533.1194 Primal inf 2.0311713e+08 (2526)
724  Obj 57854.02 Primal inf 2.3613949e+08 (2828)
1086  Obj 2.7945624e+09 Primal inf 2.6149483e+08 (3052)
1448  Obj 3.028221e+09 Primal inf 2.7838941e+08 (3215)
1810  Obj 3.2790364e+09 Primal inf 2.8919513e+08 (3325)
2172  Obj 3.5661458e+09 Primal inf 2.9340495e+08 (3404)
2534  Obj 3.8615063e+09 Primal inf 3.0078977e+08 (3476)
2896  Obj 4.1368103e+09 Primal inf 3.0506132e+08 (3523)
3258  Obj 4.35539e+09 Primal inf 3.0659227e+08 (3566)
3620  Obj 4.5115102e+09 Primal inf 2.9965418e+08 (3578)
3982  Obj 4.7012691e+09 Primal inf 3.0619855e+08 (3619)
4344  Obj 4.929369e+09 Primal inf 2.9669713e+08 (3640)
4706  Obj 5.0927827e+09 Primal inf 2.9536911e+08 (3672)
5068  Obj 5.436143e+09 Primal inf 2.8590574e+08 (3668)
5430  Obj 5.7259353e+09 Primal inf 2.794528e+08 (3668)
5792  Obj 6.0526507e+09 Primal inf 2.7091083e+08 (3659)
6154  Obj 6.1922592e+09 Primal inf 2.6075623e+08 (3640)
6516  Obj 6.5929942e+09 Primal inf 2.4730128e+08 (3596)
6878  Obj 6.8999994e+09 Primal inf 2.3833123e+08 (3580)
7240  Obj 7.321848e+09 Primal inf 2.2978354e+08 (3521)
7602  Obj 7.5556003e+09 Primal inf 2.2398371e+08 (3471)
7964  Obj 8.0534511e+09 Primal inf 2.1426713e+08 (3430)
8326  Obj 8.3290574e+09 Primal inf 2.1154715e+08 (3398)
8688  Obj 8.5715647e+09 Primal inf 2.0633831e+08 (3364)
9050  Obj 9.682397e+09 Primal inf 2.1427809e+08 (4887)
9412  Obj 9.6886303e+09 Primal inf 2.529289e+08 (4908)
9774  Obj 9.704828e+09 Primal inf 2.6084472e+08 (4903)
10136  Obj 1.0760398e+10 Primal inf 2.9881936e+08 (4810)
10498  Obj 1.0797379e+10 Primal inf 2.9996741e+08 (4839)
10860  Obj 1.1855959e+10 Primal inf 3.5462692e+08 (4798)
11222  Obj 1.2456885e+10 Primal inf 3.7589544e+08 (4741)
11584  Obj 1.246172e+10 Primal inf 4.5091986e+08 (4724)
11946  Obj 1.286283e+10 Primal inf 4.2339496e+08 (4664)
12308  Obj 1.2875637e+10 Primal inf 4.080516e+08 (4561)
12670  Obj 1.3306147e+10 Primal inf 4.6696308e+08 (4568)
13032  Obj 1.3964576e+10 Primal inf 4.9646534e+08 (4520)
13394  Obj 1.6522008e+10 Primal inf 1.1255549e+09 (9858)
13756  Obj 1.7520951e+10 Primal inf 9.0172701e+08 (9825)
14118  Obj 1.9519323e+10 Primal inf 4.1939903e+10 (10572)
14480  Obj 2.0678206e+10 Primal inf 3.762443e+08 (9577)
14842  Obj 2.1604123e+10 Primal inf 1.6579959e+09 (9852)
15204  Obj 2.2511088e+10 Primal inf 3.8866454e+08 (9275)
15566  Obj 2.3434464e+10 Primal inf 1.4439749e+09 (10129)
15928  Obj 2.4614331e+10 Primal inf 6.8854048e+08 (9756)
16290  Obj 2.5188509e+10 Primal inf 5.9382179e+08 (14804)
16652  Obj 2.624008e+10 Primal inf 1.5214701e+09 (15501)
17014  Obj 2.6377172e+10 Primal inf 2.1599942e+08 (9205)
17376  Obj 2.6848297e+10 Primal inf 6.4764775e+08 (15098)
17738  Obj 2.7095683e+10 Primal inf 5.8762955e+08 (12961)
18100  Obj 2.7737909e+10 Primal inf 8.531421e+08 (12179)
18462  Obj 2.8594734e+10 Primal inf 1.121041e+09 (11473)
18824  Obj 2.8797938e+10 Primal inf 2.3804347e+08 (11360)
19186  Obj 2.9125184e+10 Primal inf 1.4683037e+08 (9107)
19548  Obj 2.9632056e+10 Primal inf 7.0713116e+08 (9614)
19910  Obj 2.9836903e+10 Primal inf 1.0275581e+08 (8584)
20272  Obj 3.020131e+10 Primal inf 51106556 (3041)
20634  Obj 3.0428613e+10 Primal inf 40655549 (3144)
20996  Obj 3.0717038e+10 Primal inf 58199093 (8687)
21358  Obj 3.0954336e+10 Primal inf 1.8172389e+08 (3159)
21720  Obj 3.1157817e+10 Primal inf 1.4684851e+08 (8391)
22082  Obj 3.1306301e+10 Primal inf 96536580 (4131)
22444  Obj 3.1511655e+10 Primal inf 68393900 (8803)
22806  Obj 3.1796963e+10 Primal inf 1.2193608e+08 (2760)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 21906 primals, 50377 duals
Objective: 3.22e+10
Solver model: not available
Solver message: Optimal - objective value 32192481955.19140244
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>23168  Obj 3.1955471e+10 Primal inf 83959436 (2774)
23530  Obj 3.2059272e+10 Primal inf 36714476 (3017)
23892  Obj 3.2148527e+10 Primal inf 6577358.7 (7603)
24254  Obj 3.2185235e+10 Primal inf 231537.73 (324)
24477  Obj 3.219249e+10
Optimal - objective value 3.2192482e+10
After Postsolve, objective 3.2192482e+10, infeasibilities - dual 0 (0), primal 0 (0)
Optimal objective 3.219248196e+10 - 24477 iterations time 10.142, Presolve 0.04
Total time (CPU seconds):       10.37   (Wallclock seconds):       10.39
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

&lt;__array_function__ internals&gt;:200: RuntimeWarning:

invalid value encountered in cast

INFO:linopy.model: Solve linear problem using Cbc solver
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.io:Writing objective.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.:   0%|          | 0/15 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.:  53%|█████▎    | 8/15 [00:00&lt;00:00, 68.07it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.: 100%|██████████| 15/15 [00:00&lt;00:00, 55.71it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing constraints.: 100%|██████████| 15/15 [00:00&lt;00:00, 57.22it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing variables.:   0%|          | 0/7 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing variables.: 100%|██████████| 7/7 [00:00&lt;00:00, 174.05it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.io: Writing time: 0.34s
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">54</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="k">for</span> <span class="n">co2</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">n</span><span class="o">.</span><span class="n">global_constraints</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;CO2Limit&quot;</span><span class="p">,</span> <span class="s2">&quot;constant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">co2</span> <span class="o">*</span> <span class="mf">1e6</span>
<span class="ne">----&gt; </span><span class="mi">4</span>     <span class="n">n</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">sensitivity</span><span class="p">[</span><span class="n">co2</span><span class="p">]</span> <span class="o">=</span> <span class="n">system_cost</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="nn">File ~/micromamba-root/envs/esm/lib/python3.11/site-packages/pypsa/optimization/optimize.py:479,</span> in <span class="ni">OptimizationAccessor.__call__</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">477</span> <span class="nd">@wraps</span><span class="p">(</span><span class="n">optimize</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">478</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">479</span>     <span class="k">return</span> <span class="n">optimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/micromamba-root/envs/esm/lib/python3.11/site-packages/pypsa/optimization/optimize.py:459,</span> in <span class="ni">optimize</span><span class="nt">(n, snapshots, multi_investment_periods, linearized_unit_commitment, model_kwargs, extra_functionality, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">457</span>     <span class="n">extra_functionality</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">sns</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">458</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;solver_name&quot;</span><span class="p">,</span> <span class="s2">&quot;glpk&quot;</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">459</span> <span class="n">status</span><span class="p">,</span> <span class="n">condition</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">461</span> <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">462</span>     <span class="n">assign_solution</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="nn">File ~/micromamba-root/envs/esm/lib/python3.11/site-packages/linopy/model.py:1057,</span> in <span class="ni">Model.solve</span><span class="nt">(self, solver_name, io_api, problem_fn, solution_fn, log_fn, basis_fn, warmstart_fn, keep_files, sanitize_zeros, remote, **solver_options)</span>
<span class="g g-Whitespace">   </span><span class="mi">1055</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1056</span>     <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">solvers</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;run_</span><span class="si">{</span><span class="n">solver_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1057</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1058</span>         <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1059</span>         <span class="n">io_api</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1060</span>         <span class="n">problem_fn</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1061</span>         <span class="n">solution_fn</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1062</span>         <span class="n">log_fn</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1063</span>         <span class="n">warmstart_fn</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1064</span>         <span class="n">basis_fn</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1065</span>         <span class="n">keep_files</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1066</span>         <span class="o">**</span><span class="n">solver_options</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1067</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1068</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1069</span>     <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">(</span><span class="n">problem_fn</span><span class="p">,</span> <span class="n">solution_fn</span><span class="p">):</span>

<span class="nn">File ~/micromamba-root/envs/esm/lib/python3.11/site-packages/linopy/solvers.py:153,</span> in <span class="ni">run_cbc</span><span class="nt">(model, io_api, problem_fn, solution_fn, log_fn, warmstart_fn, basis_fn, keep_files, **solver_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">151</span> <span class="k">if</span> <span class="n">log_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">152</span>     <span class="n">p</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span> <span class="n">stdout</span><span class="o">=</span><span class="n">sub</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">sub</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">153</span>     <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">readline</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">154</span>         <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">155</span>     <span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sensitivity</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span> <span class="c1"># billion Euro/a</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">area</span><span class="p">(</span>
    <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">carriers</span><span class="o">.</span><span class="n">color</span><span class="p">),</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">),</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;CO$_2$ emissions [Mt/a]&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;System cost [bn€/a]&quot;</span><span class="p">,</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fa2d1de5910&gt;
</pre></div>
</div>
<img alt="_images/2e3fe29eb4d2e34ca5f7e59353f2d144d3feeb41e1399719ba14426f7bca3296.png" src="_images/2e3fe29eb4d2e34ca5f7e59353f2d144d3feeb41e1399719ba14426f7bca3296.png" />
</div>
</div>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">#</a></h2>
<p>Explore the model by changing the assumptions and available technologies. Here are a few inspirations:</p>
<ul class="simple">
<li><p>Rerun the model with cost assumptions for 2050.</p></li>
<li><p>What if either hydrogen or battery storage cannot be expanded?</p></li>
<li><p>What if you can either only build solar or only build wind?</p></li>
<li><p>What if we had a flat electricity demand profile (like in <a class="reference external" href="https://model.energy">model.energy</a>, i.e. average the demand time series)?</p></li>
<li><p>Vary the energy-to-power ratio of the hydrogen storage. What ratio leads to lowest costs?</p></li>
<li><p>How bad is the 4-hourly resolution used for demonstration? How does it compare to hourly or 2-hourly resolution?</p></li>
<li><p>On <a class="reference external" href="https://model.energy">model.energy</a>, you can download capacity factors for onshore wind and solar for any region in the world. Drop offshore wind from the model and use the onshore wind and solar prices from another region of the world. Try a few. What changes?</p></li>
<li><p>Add nuclear as another dispatchable low-emission generation technology (similar to OCGT). Perform a sensitivity analysis trying to answer how low the capital cost of a nuclear plant would need to be to be chosen.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="09-workshop-pypsa.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction to <code class="docutils literal notranslate"><span class="pre">pypsa</span></code></p>
      </div>
    </a>
    <a class="right-next"
       href="11-workshop-groupwork.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Preparation for Group Assignment</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#from-electricity-market-modelling-to-capacity-expansion-planning">From electricity market modelling to capacity expansion planning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites-handling-technology-data-and-costs">Prerequisites: handling technology data and costs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-time-series-data">Loading time series data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-capacity-expansion-planning-example">Simple capacity expansion planning example</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-initialisation">Model Initialisation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-components">Adding Components</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-run">Model Run</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-evaluation">Model Evaluation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-optimal-dispatch">Plotting Optimal Dispatch</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-storage-units">Adding Storage Units</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-emission-limits">Adding emission limits</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-analysis">Sensitivity Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Fabian Neumann
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022-2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>