
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Capacity Expansion Planning with pypsa &#8212; Data Science for Energy System Modelling</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Preparation for Group Assignment" href="11-workshop-groupwork.html" />
    <link rel="prev" title="Introduction to pypsa" href="09-workshop-pypsa.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Data Science for Energy System Modelling</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01-workshop-python.html">
   Introduction to
   <code class="docutils literal notranslate">
    <span class="pre">
     Python
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02-workshop-numpy.html">
   Introduction to
   <code class="docutils literal notranslate">
    <span class="pre">
     numpy
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     matplotlib
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03-workshop-pandas.html">
   Introduction to
   <code class="docutils literal notranslate">
    <span class="pre">
     pandas
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04-workshop-geopandas.html">
   Introduction to
   <code class="docutils literal notranslate">
    <span class="pre">
     geopandas
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     cartopy
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06-workshop-atlite.html">
   Introduction to
   <code class="docutils literal notranslate">
    <span class="pre">
     rasterio
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     atlite
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07-workshop-networkx.html">
   Introduction to
   <code class="docutils literal notranslate">
    <span class="pre">
     networkx
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08-workshop-pyomo.html">
   Introduction to
   <code class="docutils literal notranslate">
    <span class="pre">
     pyomo
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09-workshop-pypsa.html">
   Introduction to
   <code class="docutils literal notranslate">
    <span class="pre">
     pypsa
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Capacity Expansion Planning with
   <code class="docutils literal notranslate">
    <span class="pre">
     pypsa
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11-workshop-groupwork.html">
   Preparation for Group Assignment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12-workshop-pypsa-sector-coupling.html">
   Sector-Coupling with
   <code class="docutils literal notranslate">
    <span class="pre">
     pypsa
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13-workshop-interactive-visualisation.html">
   Interactive Visualisation and Dashboards
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/fneum/data-science-for-esm/main?urlpath=tree/data-science-for-esm/10-workshop-pypsa-cem.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/fneum/data-science-for-esm/blob/main/data-science-for-esm/10-workshop-pypsa-cem.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/fneum/data-science-for-esm"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/fneum/data-science-for-esm/issues/new?title=Issue%20on%20page%20%2F10-workshop-pypsa-cem.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/10-workshop-pypsa-cem.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#from-electricity-market-modelling-to-capacity-expansion-planning">
   From electricity market modelling to capacity expansion planning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prerequisites-handling-technology-data-and-costs">
   Prerequisites: handling technology data and costs
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-time-series-data">
   Loading time series data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simple-capacity-expansion-planning-example">
   Simple capacity expansion planning example
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-initialisation">
     Model Initialisation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-components">
     Adding Components
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-run">
     Model Run
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-evaluation">
     Model Evaluation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plotting-optimal-dispatch">
     Plotting Optimal Dispatch
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-storage-units">
   Adding Storage Units
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-emission-limits">
     Adding emission limits
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sensitivity-analysis">
   Sensitivity Analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Capacity Expansion Planning with pypsa</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#from-electricity-market-modelling-to-capacity-expansion-planning">
   From electricity market modelling to capacity expansion planning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prerequisites-handling-technology-data-and-costs">
   Prerequisites: handling technology data and costs
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-time-series-data">
   Loading time series data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simple-capacity-expansion-planning-example">
   Simple capacity expansion planning example
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-initialisation">
     Model Initialisation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-components">
     Adding Components
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-run">
     Model Run
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-evaluation">
     Model Evaluation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plotting-optimal-dispatch">
     Plotting Optimal Dispatch
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-storage-units">
   Adding Storage Units
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-emission-limits">
     Adding emission limits
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sensitivity-analysis">
   Sensitivity Analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="capacity-expansion-planning-with-pypsa">
<h1>Capacity Expansion Planning with <code class="docutils literal notranslate"><span class="pre">pypsa</span></code><a class="headerlink" href="#capacity-expansion-planning-with-pypsa" title="Permalink to this headline">#</a></h1>
<img src="https://github.com/fneum/data-science-for-esm/raw/main/data-science-for-esm/pypsa-logo.png" width="300px" /><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Also in this tutorial, you might want to refer to the PyPSA documentation: <a class="reference external" href="https://pypsa.readthedocs.io">https://pypsa.readthedocs.io</a>.</p>
</div>
<section id="from-electricity-market-modelling-to-capacity-expansion-planning">
<h2>From electricity market modelling to capacity expansion planning<a class="headerlink" href="#from-electricity-market-modelling-to-capacity-expansion-planning" title="Permalink to this headline">#</a></h2>
<p>Review the problem formulation of the electricity market model. Below you can find an adapted version
where the capacity limits have been promoted to <strong>decision variables</strong> with corresponding terms
in the <em>objective function</em> and <em>new constraints for their expansion limits</em> (e.g. wind and solar potentials). This is known as <strong>capacity expansion problem</strong>.</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
    \min_{g,e,f,G,E,F} \quad \sum_{i,s,t} w_t o_{s} g_{i,s,t} + \sum_{i,s} c_sG_{i,s}  + c_{r,\text{dis/charge}}G_{i,r, \text{dis/charge}} +   c_{r}E_{i,r}  + c_\ell F_{\ell}
  \end{equation*}\]</div>
<p>such that</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
    d_{i,t} &amp;= \sum_s g_{i,s,t}  - \sum_\ell K_{i\ell} f_{\ell,t}   &amp; \text{energy balance} \\
    0 &amp;\leq g_{i,s,t} \leq \hat{g}_{i,s,t} G_{i,s} &amp; \text{generator limits}\\
    0 &amp; \leq g_{i,r,t,\text{dis/charge}} \leq G_{i,r,\text{dis/charge}}&amp; \text{storage dis/charge limits} \\
    0 &amp; \leq e_{i,r,t} \leq E_{r} &amp; \text{storage energy limits} \\ 
    e_{i,r,t} &amp;= \eta^0_{i,r,t} e_{i,r,t-1} + \eta^1_{r}g_{i,r,t,\text{charge}} -  \frac{1}{\eta^2_{r}} g_{i,r,t,\text{discharge}} &amp; \text{storage consistency} \\
    -F_\ell &amp;\leq f_{\ell,t} \leq F_\ell  &amp; \text{line limits} \\
    0 &amp;= \sum_\ell C_{\ell c} x_\ell f_{\ell,t} &amp; \text{KVL} \\
        \underline{G}_{i,s} &amp; \leq G_{i,s} \leq \overline{G}_{i,s} &amp; \text{generator capacity expansion limits} \\
    \underline{G}_{i,r, \text{dis/charge}} &amp; \leq G_{i,r, \text{dis/charge}} \leq \overline{G}_{i,r, \text{dis/charge}} &amp; \text{storage power capacity expansion limits} \\
    \underline{E}_{i,r} &amp; \leq E_{i,r} \leq \overline{E}_{i,r} &amp; \text{storage energy expansion limits} \\
    \underline{F}_{\ell} &amp; \leq F_{\ell} \leq \overline{F}_{\ell} &amp; \text{line capacity expansion limits}
  \end{align*}\]</div>
<p><strong>New decision variables for capacity expansion planning:</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(G_{i,s}\)</span> is the generator capacity at bus <span class="math notranslate nohighlight">\(i\)</span>, technology <span class="math notranslate nohighlight">\(s\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(F_{\ell}\)</span> is the transmission capacity of line <span class="math notranslate nohighlight">\(\ell\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(G_{i,r,\text{dis-/charge}}\)</span> denotes the charge and discharge capacities of storage unit <span class="math notranslate nohighlight">\(r\)</span> at bus <span class="math notranslate nohighlight">\(i\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(E_{i,r}\)</span> is the energy capacity of storage <span class="math notranslate nohighlight">\(r\)</span> at bus <span class="math notranslate nohighlight">\(i\)</span> and time step <span class="math notranslate nohighlight">\(t\)</span>.</p></li>
</ul>
<p><strong>New parameters for capacity expansion planning:</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(c_{\star}\)</span> is the capital cost of technology <span class="math notranslate nohighlight">\(\star\)</span> at bus <span class="math notranslate nohighlight">\(i\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(w_t\)</span> is the weighting of time step <span class="math notranslate nohighlight">\(t\)</span> (e.g. number of hours it represents)</p></li>
<li><p><span class="math notranslate nohighlight">\(\underline{G}_\star, \underline{F}_\star, \underline{E}_\star\)</span> are the minimum capacities per technology and location/connection.</p></li>
<li><p><span class="math notranslate nohighlight">\(\underline{G}_\star, \underline{F}_\star, \underline{E}_\star\)</span> are the maximum capacities per technology and location.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a full reference to the optimisation problem description, see <a class="reference external" href="https://pypsa.readthedocs.io/en/latest/optimal_power_flow.html">https://pypsa.readthedocs.io/en/latest/optimal_power_flow.html</a></p>
</div>
<p>First things first! We need a few packages for this tutorial:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pypsa</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;bmh&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="prerequisites-handling-technology-data-and-costs">
<h2>Prerequisites: handling technology data and costs<a class="headerlink" href="#prerequisites-handling-technology-data-and-costs" title="Permalink to this headline">#</a></h2>
<p>We maintain a database (<a class="reference external" href="https://github.com/PyPSA/technology-data">https://github.com/PyPSA/technology-data</a>) which collects assumptions and projections for energy system technologies (such as costs, efficiencies, lifetimes, etc.) for given years, which we can load into a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>. This requires some pre-processing to load (e.g. converting units, setting defaults, re-arranging dimensions):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year</span> <span class="o">=</span> <span class="mi">2030</span>
<span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://raw.githubusercontent.com/PyPSA/technology-data/master/outputs/costs_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">.csv&quot;</span>
<span class="n">costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">costs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">costs</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;/kW&quot;</span><span class="p">),</span> <span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">1e3</span>
<span class="n">costs</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/kW&quot;</span><span class="p">,</span> <span class="s2">&quot;/MW&quot;</span><span class="p">)</span>

<span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;FOM&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;VOM&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;efficiency&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;fuel&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;investment&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;lifetime&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="s2">&quot;CO2 intensity&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;discount rate&quot;</span><span class="p">:</span> <span class="mf">0.07</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">costs</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>

<span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;OCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel&quot;</span><span class="p">]</span>
<span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;CCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel&quot;</span><span class="p">]</span>
<span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;OCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;CO2 intensity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;CO2 intensity&quot;</span><span class="p">]</span>
<span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;CCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;CO2 intensity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;CO2 intensity&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s also write a small utility function that calculates the <strong>annuity</strong> to annualise investment costs. The formula is</p>
<div class="math notranslate nohighlight">
\[
a(r, n) = \frac{r}{1-(1+r)^{-n}}
\]</div>
<p>where <span class="math notranslate nohighlight">\(r\)</span> is the discount rate and <span class="math notranslate nohighlight">\(n\)</span> is the lifetime.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">annuity</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">r</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annuity</span><span class="p">(</span><span class="mf">0.07</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.09439292574325567
</pre></div>
</div>
</div>
</div>
<p>Based on this, we can calculate the short-term marginal generation costs (STMGC, €/MWh):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">costs</span><span class="p">[</span><span class="s2">&quot;marginal_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">costs</span><span class="p">[</span><span class="s2">&quot;VOM&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">costs</span><span class="p">[</span><span class="s2">&quot;fuel&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">costs</span><span class="p">[</span><span class="s2">&quot;efficiency&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>and the annualised investment costs (<code class="docutils literal notranslate"><span class="pre">capital_cost</span></code> in PyPSA terms, €/MW/a):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annuity</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">annuity</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;discount rate&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;lifetime&quot;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">costs</span><span class="p">[</span><span class="s2">&quot;capital_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">annuity</span> <span class="o">+</span> <span class="n">costs</span><span class="p">[</span><span class="s2">&quot;FOM&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">costs</span><span class="p">[</span><span class="s2">&quot;investment&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="loading-time-series-data">
<h2>Loading time series data<a class="headerlink" href="#loading-time-series-data" title="Permalink to this headline">#</a></h2>
<p>We are also going to need some time series for wind, solar and load. For now, we are going to recycle the time series we used at the beginning of the course. They are given for Germany in the year 2015.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/fneum/data-science-for-esm/main/data-science-for-esm/time-series-lecture-2.csv&quot;</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>load</th>
      <th>onwind</th>
      <th>offwind</th>
      <th>solar</th>
      <th>prices</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-01 00:00:00</th>
      <td>41.151</td>
      <td>0.1566</td>
      <td>0.7030</td>
      <td>0.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2015-01-01 01:00:00</th>
      <td>40.135</td>
      <td>0.1659</td>
      <td>0.6875</td>
      <td>0.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2015-01-01 02:00:00</th>
      <td>39.106</td>
      <td>0.1746</td>
      <td>0.6535</td>
      <td>0.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s convert the load time series from GW to MW, the base unit of PyPSA:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="o">.</span><span class="n">load</span> <span class="o">*=</span> <span class="mf">1e3</span>
</pre></div>
</div>
</div>
</div>
<p>We are also going to adapt the temporal resolution of the time series, e.g. sample only every other hour, to save some time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resolution</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s2">H&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="simple-capacity-expansion-planning-example">
<h2>Simple capacity expansion planning example<a class="headerlink" href="#simple-capacity-expansion-planning-example" title="Permalink to this headline">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See also <a class="reference external" href="https://model.energy">https://model.energy</a>.</p>
</div>
<p><strong>In this tutorial, we want to build a replica of <a class="reference external" href="https://model.energy">model.energy</a>.</strong> This tool calculates the cost of meeting a constant electricity demand from a combination of wind power, solar power and storage for different regions of the world.</p>
<p>We deviate from <a class="reference external" href="https://model.energy">model.energy</a> by including offshore wind generation and electricity demand profiles rather than a constant electricity demand. Also, we are going to start with Germany only. You can adapt the code to other countries as an exercise.</p>
<section id="model-initialisation">
<h3>Model Initialisation<a class="headerlink" href="#model-initialisation" title="Permalink to this headline">#</a></h3>
<p>For building the model, we start again by initialising an empty network.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="n">pypsa</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we add a single bus…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;Bus&quot;</span><span class="p">,</span> <span class="s2">&quot;electricity&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>…and tell the <code class="docutils literal notranslate"><span class="pre">pypsa.Network</span></code> object <code class="docutils literal notranslate"><span class="pre">n</span></code> what the snapshots of the model will be using the utility function <code class="docutils literal notranslate"><span class="pre">n.set_snapshots()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">set_snapshots</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">snapshots</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatetimeIndex([&#39;2015-01-01 00:00:00&#39;, &#39;2015-01-01 04:00:00&#39;,
               &#39;2015-01-01 08:00:00&#39;, &#39;2015-01-01 12:00:00&#39;,
               &#39;2015-01-01 16:00:00&#39;, &#39;2015-01-01 20:00:00&#39;,
               &#39;2015-01-02 00:00:00&#39;, &#39;2015-01-02 04:00:00&#39;,
               &#39;2015-01-02 08:00:00&#39;, &#39;2015-01-02 12:00:00&#39;,
               ...
               &#39;2015-12-30 08:00:00&#39;, &#39;2015-12-30 12:00:00&#39;,
               &#39;2015-12-30 16:00:00&#39;, &#39;2015-12-30 20:00:00&#39;,
               &#39;2015-12-31 00:00:00&#39;, &#39;2015-12-31 04:00:00&#39;,
               &#39;2015-12-31 08:00:00&#39;, &#39;2015-12-31 12:00:00&#39;,
               &#39;2015-12-31 16:00:00&#39;, &#39;2015-12-31 20:00:00&#39;],
              dtype=&#39;datetime64[ns]&#39;, name=&#39;snapshot&#39;, length=2190, freq=&#39;4H&#39;)
</pre></div>
</div>
</div>
</div>
<p>The weighting of the snapshots (e.g. how many hours they represent, see <span class="math notranslate nohighlight">\(w_t\)</span> in problem formulation above) can be set in <code class="docutils literal notranslate"><span class="pre">n.snapshot_weightings</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>objective</th>
      <th>stores</th>
      <th>generators</th>
    </tr>
    <tr>
      <th>snapshot</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-01 00:00:00</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2015-01-01 04:00:00</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2015-01-01 08:00:00</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">resolution</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>objective</th>
      <th>stores</th>
      <th>generators</th>
    </tr>
    <tr>
      <th>snapshot</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-01 00:00:00</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2015-01-01 04:00:00</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2015-01-01 08:00:00</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="adding-components">
<h3>Adding Components<a class="headerlink" href="#adding-components" title="Permalink to this headline">#</a></h3>
<p>Then, we add all the technologies we are going to include as carriers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carriers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;onwind&quot;</span><span class="p">,</span> <span class="s2">&quot;offwind&quot;</span><span class="p">,</span> <span class="s2">&quot;solar&quot;</span><span class="p">,</span> <span class="s2">&quot;OCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;hydrogen storage underground&quot;</span><span class="p">,</span> <span class="s2">&quot;battery storage&quot;</span><span class="p">]</span>

<span class="n">n</span><span class="o">.</span><span class="n">madd</span><span class="p">(</span>
    <span class="s2">&quot;Carrier&quot;</span><span class="p">,</span>
    <span class="n">carriers</span><span class="p">,</span> 
    <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dodgerblue&quot;</span><span class="p">,</span> <span class="s2">&quot;aquamarine&quot;</span><span class="p">,</span> <span class="s2">&quot;gold&quot;</span><span class="p">,</span> <span class="s2">&quot;indianred&quot;</span><span class="p">,</span> <span class="s2">&quot;magenta&quot;</span><span class="p">,</span> <span class="s2">&quot;yellowgreen&quot;</span><span class="p">],</span>
    <span class="n">co2_emissions</span><span class="o">=</span><span class="p">[</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;CO2 intensity&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">carriers</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;onwind&#39;, &#39;offwind&#39;, &#39;solar&#39;, &#39;OCGT&#39;, &#39;hydrogen storage underground&#39;,
       &#39;battery storage&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>Next, we add the demand time series to the model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="s2">&quot;Load&quot;</span><span class="p">,</span>
    <span class="s2">&quot;demand&quot;</span><span class="p">,</span>
    <span class="n">bus</span><span class="o">=</span><span class="s2">&quot;electricity&quot;</span><span class="p">,</span>
    <span class="n">p_set</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">load</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s have a check whether the data was read-in correctly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;MW&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;snapshot&#39;, ylabel=&#39;MW&#39;&gt;
</pre></div>
</div>
<img alt="_images/10-workshop-pypsa-cem_47_1.png" src="_images/10-workshop-pypsa-cem_47_1.png" />
</div>
</div>
<p>We are going to add one dispatchable generation technology to the model. This is an open-cycle gas turbine (OCGT) with CO<span class="math notranslate nohighlight">\(_2\)</span> emissions of 0.2 t/MWh<span class="math notranslate nohighlight">\(_{th}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="s2">&quot;Generator&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OCGT&quot;</span><span class="p">,</span>
    <span class="n">bus</span><span class="o">=</span><span class="s1">&#39;electricity&#39;</span><span class="p">,</span>
    <span class="n">carrier</span><span class="o">=</span><span class="s2">&quot;OCGT&quot;</span><span class="p">,</span>
    <span class="n">capital_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;OCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">],</span>
    <span class="n">marginal_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;OCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;marginal_cost&quot;</span><span class="p">],</span>
    <span class="n">efficiency</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;OCGT&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
    <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Adding the variable renewable generators works almost identically, but we also need to supply the capacity factors to the model via the attribute <code class="docutils literal notranslate"><span class="pre">p_max_pu</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">tech</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;onwind&quot;</span><span class="p">,</span> <span class="s2">&quot;offwind&quot;</span><span class="p">,</span> <span class="s2">&quot;solar&quot;</span><span class="p">]:</span>
    <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;Generator&quot;</span><span class="p">,</span>
        <span class="n">tech</span><span class="p">,</span>
        <span class="n">bus</span><span class="o">=</span><span class="s1">&#39;electricity&#39;</span><span class="p">,</span>
        <span class="n">carrier</span><span class="o">=</span><span class="n">tech</span><span class="p">,</span>
        <span class="n">p_max_pu</span><span class="o">=</span><span class="n">ts</span><span class="p">[</span><span class="n">tech</span><span class="p">],</span>
        <span class="n">capital_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">tech</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">],</span>
        <span class="n">marginal_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">tech</span><span class="p">,</span> <span class="s2">&quot;marginal_cost&quot;</span><span class="p">],</span>
        <span class="n">efficiency</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">tech</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
        <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>So let’s make sure the capacity factors are read-in correctly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p_max_pu</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;2015-03&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;CF&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;snapshot&#39;, ylabel=&#39;CF&#39;&gt;
</pre></div>
</div>
<img alt="_images/10-workshop-pypsa-cem_53_1.png" src="_images/10-workshop-pypsa-cem_53_1.png" />
</div>
</div>
</section>
<section id="model-run">
<h3>Model Run<a class="headerlink" href="#model-run" title="Permalink to this headline">#</a></h3>
<p>Then, we can already solve the model for the first time. At this stage, the model does not have any storage or emission limits implemented. It’s going to look for the least-cost combination of variable renewables and the gas turbine to supply demand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">lopf</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s1">&#39;gurobi&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:pypsa.linopf:Prepare linear problem
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:pypsa.linopf:Total preparation time: 0.33s
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:pypsa.linopf:Solve linear problem using Gurobi solver
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">26</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">n</span><span class="o">.</span><span class="n">lopf</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s1">&#39;gurobi&#39;</span><span class="p">)</span>

<span class="nn">File ~/micromamba-root/envs/esm/lib/python3.9/site-packages/pypsa/components.py:764,</span> in <span class="ni">Network.lopf</span><span class="nt">(self, snapshots, pyomo, solver_name, solver_options, solver_logfile, formulation, keep_files, extra_functionality, multi_investment_periods, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">762</span> <span class="k">if</span> <span class="n">pyomo</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">763</span>     <span class="k">return</span> <span class="n">network_lopf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">764</span> <span class="k">return</span> <span class="n">network_lopf_lowmem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>

<span class="nn">File ~/micromamba-root/envs/esm/lib/python3.9/site-packages/pypsa/linopf.py:1472,</span> in <span class="ni">network_lopf</span><span class="nt">(n, snapshots, solver_name, solver_logfile, extra_functionality, multi_investment_periods, skip_objective, skip_pre, extra_postprocessing, formulation, keep_references, keep_files, keep_shadowprices, solver_options, warmstart, store_basis, solver_dir)</span>
<span class="g g-Whitespace">   </span><span class="mi">1469</span>     <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Solve linear problem using </span><span class="si">{</span><span class="n">solver_name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2"> solver&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1471</span> <span class="n">solve</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;run_and_read_</span><span class="si">{</span><span class="n">solver_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1472</span> <span class="n">res</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1473</span>     <span class="n">n</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1474</span>     <span class="n">problem_fn</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1475</span>     <span class="n">solution_fn</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1476</span>     <span class="n">solver_logfile</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1477</span>     <span class="n">solver_options</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1478</span>     <span class="n">warmstart</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1479</span>     <span class="n">store_basis</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1480</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1482</span> <span class="n">status</span><span class="p">,</span> <span class="n">termination_condition</span><span class="p">,</span> <span class="n">variables_sol</span><span class="p">,</span> <span class="n">constraints_dual</span><span class="p">,</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">res</span>
<span class="g g-Whitespace">   </span><span class="mi">1484</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_files</span><span class="p">:</span>

<span class="nn">File ~/micromamba-root/envs/esm/lib/python3.9/site-packages/pypsa/linopt.py:1063,</span> in <span class="ni">run_and_read_gurobi</span><span class="nt">(n, problem_fn, solution_fn, solver_logfile, solver_options, warmstart, store_basis)</span>
<span class="g g-Whitespace">   </span><span class="mi">1053</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1054</span><span class="sd"> Solving function. Reads the linear problem file and passes it to the gurobi</span>
<span class="g g-Whitespace">   </span><span class="mi">1055</span><span class="sd"> solver. If the solution is successful it returns variable solutions and</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">   </span><span class="mi">1060</span><span class="sd"> &lt;https://www.gurobi.com/documentation/{gurobi_verion}/refman/parameter_descriptions.html&gt;_</span>
<span class="g g-Whitespace">   </span><span class="mi">1061</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1062</span> <span class="k">if</span> <span class="n">find_spec</span><span class="p">(</span><span class="s2">&quot;gurobipy&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1063</span>     <span class="k">raise</span> <span class="ne">ModuleNotFoundError</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1064</span>         <span class="s2">&quot;Optional dependency &#39;gurobipy&#39; not found. &quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1065</span>         <span class="s2">&quot;Install via &#39;conda install -c gurobi gurobi&#39;  or follow the &quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1066</span>         <span class="s2">&quot;instructions on the documentation page &quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1067</span>         <span class="s2">&quot;https://www.gurobi.com/documentation/&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1068</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1069</span> <span class="kn">import</span> <span class="nn">gurobipy</span>
<span class="g g-Whitespace">   </span><span class="mi">1071</span> <span class="c1"># disable logging for this part, as gurobi output is doubled otherwise</span>

<span class="ne">ModuleNotFoundError</span>: Optional dependency &#39;gurobipy&#39; not found. Install via &#39;conda install -c gurobi gurobi&#39;  or follow the instructions on the documentation page https://www.gurobi.com/documentation/
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-evaluation">
<h3>Model Evaluation<a class="headerlink" href="#model-evaluation" title="Permalink to this headline">#</a></h3>
<p>The total system cost in billion Euros per year:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">objective</span> <span class="o">/</span> <span class="mf">1e9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>27.532289225227498
</pre></div>
</div>
</div>
</div>
<p>The optimised capacities in GW:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom_opt</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span> <span class="c1"># GW</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generator
OCGT       70.182246
onwind      0.000000
offwind    42.399533
solar      82.323420
Name: p_nom_opt, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>The total energy generation by technology in GW:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">generators</span> <span class="o">@</span> <span class="n">n</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># TWh</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generator
OCGT       258.400419
onwind       0.000000
offwind    131.445301
solar       89.080020
Name: generators, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>While we get the objective value through <code class="docutils literal notranslate"><span class="pre">n.objective</span></code>, in many cases we want to know how the costs are distributed across the technologies</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">opex</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">generators</span> <span class="o">@</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">marginal_cost</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># M€/a</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">capex</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom_opt</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">capital_cost</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># M€/a</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">capex</span> <span class="o">+</span> <span class="n">opex</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generator
OCGT       16995.624249
onwind         0.000000
offwind     6707.003079
solar       3829.661896
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>If you have the newest version of PyPSA installed, you can also run the following to determine the total system cost by technology:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">capex</span><span class="p">()</span> <span class="o">+</span> <span class="n">n</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">opex</span><span class="p">(</span><span class="n">aggregate_time</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           carrier
Generator  OCGT       16995.624249
           offwind     6707.003079
           onwind         0.000000
           solar       3829.661896
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Possibly, we are also interested in the total emissions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">emissions</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p</span> <span class="o">/</span> <span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">efficiency</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">carrier</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">carriers</span><span class="o">.</span><span class="n">co2_emissions</span><span class="p">)</span> <span class="c1"># t/h</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">generators</span> <span class="o">@</span> <span class="n">emissions</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># Mt</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>126.04898508063908
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-optimal-dispatch">
<h3>Plotting Optimal Dispatch<a class="headerlink" href="#plotting-optimal-dispatch" title="Permalink to this headline">#</a></h3>
<p>This function takes the network object <code class="docutils literal notranslate"><span class="pre">n</span></code> as an argument and, optionally, a time frame. We want to plot the load time series, and stacked area charts for electricity feed-in and storage charging. Technologies should be coloured by their color defined in <code class="docutils literal notranslate"><span class="pre">n.carriers</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_dispatch</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="s2">&quot;2015-07&quot;</span><span class="p">):</span>
    
    <span class="n">p_by_carrier</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">carrier</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">sto</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">storage_units_t</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">carrier</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span>
        <span class="n">p_by_carrier</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">p_by_carrier</span><span class="p">,</span> <span class="n">sto</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    
    <span class="n">color</span> <span class="o">=</span> <span class="n">p_by_carrier</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">carriers</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
    
    <span class="n">p_by_carrier</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p_by_carrier</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">area</span><span class="p">(</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="n">charge</span> <span class="o">=</span> <span class="n">p_by_carrier</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p_by_carrier</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">time</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">charge</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>

        <span class="n">charge</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">area</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">charge</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">carriers</span><span class="o">.</span><span class="n">color</span><span class="p">),</span>
        <span class="p">)</span>
    
    <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;GW&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Oje, that was complicated. Let’s test it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_dispatch</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10-workshop-pypsa-cem_77_0.png" src="_images/10-workshop-pypsa-cem_77_0.png" />
</div>
</div>
</section>
</section>
<section id="adding-storage-units">
<h2>Adding Storage Units<a class="headerlink" href="#adding-storage-units" title="Permalink to this headline">#</a></h2>
<p>Alright, but there are a few important components missing for a system with high shares of renewables? What about short-term storage options (e.g. batteries) and long-term storage options (e.g. hydrogen storage)? Let’s add them too.</p>
<p>First, the battery storage. We are going to assume a fixed energy-to-power ratio of 6 hours, i.e. if fully charged, the battery can discharge at full capacity for 6 hours.
For the capital cost, we have to factor in both the capacity and energy cost of the storage. We are also going to enforce a cyclic state-of-charge condition, i.e. the state of charge
at the beginning of the optimisation period must equal the final state of charge.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="s2">&quot;StorageUnit&quot;</span><span class="p">,</span>
    <span class="s2">&quot;battery storage&quot;</span><span class="p">,</span>
    <span class="n">bus</span><span class="o">=</span><span class="s1">&#39;electricity&#39;</span><span class="p">,</span>
    <span class="n">carrier</span><span class="o">=</span><span class="s2">&quot;battery storage&quot;</span><span class="p">,</span>
    <span class="n">max_hours</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">capital_cost</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;battery inverter&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;battery storage&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">],</span>
    <span class="n">efficiency_store</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;battery inverter&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
    <span class="n">efficiency_dispatch</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;battery inverter&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
    <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cyclic_state_of_charge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Second, the hydrogen storage. This one is composed of an electrolysis to convert electricity to hydrogen, a fuel cell to re-convert hydrogen to electricity and underground storage (e.g. in salt caverns). We assume an energy-to-power ratio of 168 hours, such that this type of storage can be used for weekly balancing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">capital_costs</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;electrolysis&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">]</span> <span class="o">+</span>
    <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;fuel cell&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">]</span> <span class="o">+</span>
    <span class="mi">168</span> <span class="o">*</span> <span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;hydrogen storage underground&quot;</span><span class="p">,</span> <span class="s2">&quot;capital_cost&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="s2">&quot;StorageUnit&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hydrogen storage underground&quot;</span><span class="p">,</span>
    <span class="n">bus</span><span class="o">=</span><span class="s2">&quot;electricity&quot;</span><span class="p">,</span>
    <span class="n">carrier</span><span class="o">=</span><span class="s2">&quot;hydrogen storage underground&quot;</span><span class="p">,</span>
    <span class="n">max_hours</span><span class="o">=</span><span class="mi">168</span><span class="p">,</span>
    <span class="n">capital_cost</span><span class="o">=</span><span class="n">capital_costs</span><span class="p">,</span>
    <span class="n">efficiency_store</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;electrolysis&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
    <span class="n">efficiency_dispatch</span><span class="o">=</span><span class="n">costs</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">&quot;fuel cell&quot;</span><span class="p">,</span> <span class="s2">&quot;efficiency&quot;</span><span class="p">],</span>
    <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cyclic_state_of_charge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Ok, lets run the again, now with storage, and see what’s changed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">lopf</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s1">&#39;gurobi&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:pypsa.linopf:Prepare linear problem
INFO:pypsa.linopf:Total preparation time: 0.35s
INFO:pypsa.linopf:Solve linear problem using Gurobi solver
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Read LP format model from file /tmp/pypsa-problem-n__x3qgc.lp
Reading time = 0.07 seconds
obj: 50370 rows, 21907 columns, 99690 nonzeros
Gurobi Optimizer version 10.0.0 build v10.0.0rc2 (linux64)

CPU model: AMD Ryzen 7 PRO 4750U with Radeon Graphics, instruction set [SSE2|AVX|AVX2]
Thread count: 8 physical cores, 16 logical processors, using up to 16 threads

Optimize a model with 50370 rows, 21907 columns and 99690 nonzeros
Model fingerprint: 0xfabf6dc5
Coefficient statistics:
  Matrix range     [1e-04, 2e+02]
  Objective range  [4e-02, 3e+05]
  Bounds range     [0e+00, 0e+00]
  RHS range        [3e+04, 8e+04]
Presolve removed 22950 rows and 1051 columns
Presolve time: 0.04s
Presolved: 27420 rows, 20856 columns, 75690 nonzeros

Concurrent LP optimizer: primal simplex, dual simplex, and barrier
Showing barrier log only...

Ordering time: 0.03s

Barrier statistics:
 Dense cols : 6
 AA&#39; NZ     : 6.360e+04
 Factor NZ  : 4.597e+05 (roughly 23 MB of memory)
 Factor Ops : 8.066e+06 (less than 1 second per iteration)
 Threads    : 6

                  Objective                Residual
Iter       Primal          Dual         Primal    Dual     Compl     Time
   0   3.46028251e+11  0.00000000e+00  4.89e+05 0.00e+00  8.23e+08     0s
   1   5.86294644e+11 -2.68100808e+11  3.20e+04 9.11e+02  2.13e+08     0s
   2   3.23306883e+11 -1.02311384e+10  1.72e+01 4.32e+01  1.67e+07     0s
   3   1.79638403e+11  8.36193943e+09  5.76e+00 8.95e+00  5.80e+06     0s
   4   1.11985896e+11  1.33596735e+10  2.95e+00 3.37e+00  2.85e+06     0s
   5   7.38813159e+10  1.73473123e+10  1.57e+00 1.49e+00  1.50e+06     0s
   6   4.75766371e+10  2.07418731e+10  6.71e-01 6.36e-01  6.80e+05     0s
   7   3.64219322e+10  2.29396058e+10  2.75e-01 2.84e-01  3.36e+05     0s
   8   3.27919329e+10  2.42933936e+10  1.65e-01 1.45e-01  2.10e+05     0s
   9   3.15806029e+10  2.51807971e+10  1.29e-01 1.16e-01  1.57e+05     0s
  10   3.10468216e+10  2.58882651e+10  1.12e-01 5.58e-02  1.26e+05     1s
  11   3.00012227e+10  2.62228673e+10  7.87e-02 3.67e-02  9.21e+04     1s
  12   2.99561744e+10  2.63042125e+10  7.72e-02 3.40e-02  8.90e+04     1s
  13   2.93923769e+10  2.67986566e+10  5.36e-02 2.47e-02  6.31e+04     1s
  14   2.88749432e+10  2.70435635e+10  3.67e-02 1.19e-02  4.45e+04     1s
  15   2.85602693e+10  2.71982764e+10  2.73e-02 4.27e-03  3.30e+04     1s
  16   2.83148269e+10  2.73275372e+10  2.03e-02 5.82e-11  2.39e+04     1s
  17   2.82851110e+10  2.73393127e+10  1.93e-02 3.64e-12  2.29e+04     1s
  18   2.79566953e+10  2.74331673e+10  1.05e-02 1.40e-09  1.26e+04     1s
  19   2.79057647e+10  2.74440949e+10  9.16e-03 1.05e-09  1.12e+04     1s
  20   2.77598611e+10  2.74816549e+10  5.46e-03 1.60e-10  6.72e+03     1s
  21   2.76805613e+10  2.75021706e+10  3.49e-03 1.75e-09  4.30e+03     1s
  22   2.76629052e+10  2.75097904e+10  3.06e-03 1.02e-10  3.69e+03     1s
  23   2.76020497e+10  2.75191397e+10  1.60e-03 5.82e-10  2.00e+03     1s
  24   2.75765884e+10  2.75227568e+10  9.78e-04 6.98e-10  1.30e+03     1s
  25   2.75663736e+10  2.75275765e+10  7.44e-04 1.75e-10  9.34e+02     1s
  26   2.75566410e+10  2.75287729e+10  5.23e-04 5.82e-11  6.71e+02     1s
  27   2.75435630e+10  2.75305139e+10  2.41e-04 6.40e-10  3.14e+02     1s
  28   2.75377603e+10  2.75316029e+10  1.14e-04 3.49e-10  1.48e+02     1s
  29   2.75341939e+10  2.75321870e+10  3.55e-05 3.49e-10  4.82e+01     1s
  30   2.75324281e+10  2.75322795e+10  2.22e-06 8.15e-10  3.57e+00     1s
  31   2.75322978e+10  2.75322883e+10  1.31e-07 0.00e+00  2.28e-01     1s
  32   2.75322893e+10  2.75322892e+10  4.15e-08 2.91e-10  2.05e-03     1s
  33   2.75322892e+10  2.75322892e+10  1.67e-10 7.65e-10  1.29e-05     1s
  34   2.75322892e+10  2.75322892e+10  1.20e-09 4.07e-10  1.60e-11     1s

Barrier solved model in 34 iterations and 1.43 seconds (0.37 work units)
Optimal objective 2.75322892e+10

Crossover log...

   19753 DPushes remaining with DInf 0.0000000e+00                 1s
       0 DPushes remaining with DInf 0.0000000e+00                 1s

       3 PPushes remaining with PInf 0.0000000e+00                 1s
       0 PPushes remaining with PInf 0.0000000e+00                 1s

  Push phase complete: Pinf 0.0000000e+00, Dinf 2.5834741e-09      1s


Solved with barrier
Iteration    Objective       Primal Inf.    Dual Inf.      Time
    8996    2.7532289e+10   0.000000e+00   0.000000e+00      2s

Solved in 8996 iterations and 1.51 seconds (0.42 work units)
Optimal objective  2.753228923e+10
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:pypsa.linopf:Optimization successful. Objective value: 2.75e+10
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;ok&#39;, &#39;optimal&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom_opt</span> <span class="c1"># MW</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generator
OCGT       70182.245794
onwind         0.000000
offwind    42399.532710
solar      82323.420397
Name: p_nom_opt, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">p_nom_opt</span> <span class="c1"># MW</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>StorageUnit
battery storage                 0.0
hydrogen storage underground    0.0
Name: p_nom_opt, dtype: float64
</pre></div>
</div>
</div>
</div>
<p><strong>Nothing!</strong> The objective value is the same, and no storage is built.</p>
<section id="adding-emission-limits">
<h3>Adding emission limits<a class="headerlink" href="#adding-emission-limits" title="Permalink to this headline">#</a></h3>
<p>The gas power plant offers sufficient and cheap enough backup capacity to run in periods of low wind and solar generation. But what happens if this source of flexibility disappears. Let’s model a 100% renewable electricity system by adding a CO<span class="math notranslate nohighlight">\(_2\)</span> emission limit as global constraint:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="s2">&quot;GlobalConstraint&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CO2Limit&quot;</span><span class="p">,</span>
    <span class="n">carrier_attribute</span><span class="o">=</span><span class="s2">&quot;co2_emissions&quot;</span><span class="p">,</span>
    <span class="n">sense</span><span class="o">=</span><span class="s2">&quot;&lt;=&quot;</span><span class="p">,</span>
    <span class="n">constant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>When we run the model now…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">lopf</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s1">&#39;gurobi&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:pypsa.linopf:Prepare linear problem
INFO:pypsa.linopf:Total preparation time: 0.31s
INFO:pypsa.linopf:Solve linear problem using Gurobi solver
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Read LP format model from file /tmp/pypsa-problem-jq3j7msx.lp
Reading time = 0.07 seconds
obj: 50371 rows, 21907 columns, 101880 nonzeros
Gurobi Optimizer version 10.0.0 build v10.0.0rc2 (linux64)

CPU model: AMD Ryzen 7 PRO 4750U with Radeon Graphics, instruction set [SSE2|AVX|AVX2]
Thread count: 8 physical cores, 16 logical processors, using up to 16 threads

Optimize a model with 50371 rows, 21907 columns and 101880 nonzeros
Model fingerprint: 0xb3351325
Coefficient statistics:
  Matrix range     [1e-04, 2e+02]
  Objective range  [4e-02, 3e+05]
  Bounds range     [0e+00, 0e+00]
  RHS range        [3e+04, 8e+04]
Presolve removed 25141 rows and 3242 columns
Presolve time: 0.04s
Presolved: 25230 rows, 18665 columns, 69120 nonzeros

Concurrent LP optimizer: primal simplex, dual simplex, and barrier
Showing barrier log only...

Ordering time: 0.03s

Barrier statistics:
 Dense cols : 5
 AA&#39; NZ     : 5.922e+04
 Factor NZ  : 3.852e+05 (roughly 20 MB of memory)
 Factor Ops : 6.160e+06 (less than 1 second per iteration)
 Threads    : 6

                  Objective                Residual
Iter       Primal          Dual         Primal    Dual     Compl     Time
   0   3.26455533e+11  0.00000000e+00  4.20e+05 0.00e+00  9.00e+08     0s
   1   6.59604884e+11 -2.02977151e+11  1.75e+04 9.06e+02  2.43e+08     0s
   2   3.69071227e+11  2.17059887e+08  9.47e+00 1.02e+02  3.27e+07     0s
   3   1.98543341e+11  1.80773501e+10  2.82e+00 2.45e+01  9.55e+06     0s
   4   1.32941059e+11  2.29695191e+10  1.41e+00 1.05e+01  4.58e+06     0s
   5   9.66157086e+10  2.72943541e+10  7.85e-01 5.90e+00  2.60e+06     0s
   6   9.33636637e+10  3.08328747e+10  7.18e-01 4.08e+00  2.17e+06     0s
   7   8.16113755e+10  3.97280276e+10  5.06e-01 2.42e+00  1.40e+06     0s
   8   7.71055593e+10  4.61866065e+10  3.60e-01 1.78e+00  1.03e+06     0s
   9   7.19347687e+10  5.23984250e+10  1.83e-01 1.15e+00  6.47e+05     0s
  10   7.01525358e+10  5.82392045e+10  1.28e-01 6.04e-01  3.83e+05     0s
  11   6.86791701e+10  6.08272087e+10  8.07e-02 3.71e-01  2.49e+05     1s
  12   6.78713256e+10  6.21137782e+10  6.21e-02 2.55e-01  1.80e+05     1s
  13   6.78514721e+10  6.24482782e+10  6.01e-02 2.28e-01  1.68e+05     1s
  14   6.71875966e+10  6.27655161e+10  4.48e-02 1.98e-01  1.39e+05     1s
  15   6.67858989e+10  6.39103546e+10  3.51e-02 9.60e-02  8.71e+04     1s
  16   6.67240976e+10  6.41482313e+10  3.26e-02 8.24e-02  7.76e+04     1s
  17   6.65854669e+10  6.44009970e+10  2.79e-02 6.89e-02  6.57e+04     1s
  18   6.63625410e+10  6.45164110e+10  2.00e-02 6.30e-02  5.60e+04     1s
  19   6.62348520e+10  6.49089144e+10  1.34e-02 4.41e-02  4.00e+04     1s
  20   6.61231531e+10  6.49701059e+10  9.36e-03 4.11e-02  3.51e+04     1s
  21   6.60831231e+10  6.50532153e+10  8.30e-03 3.66e-02  3.13e+04     1s
  22   6.60511289e+10  6.51806654e+10  7.26e-03 3.05e-02  2.64e+04     1s
  23   6.59545732e+10  6.53906785e+10  3.92e-03 2.02e-02  1.72e+04     1s
  24   6.59415762e+10  6.55657596e+10  3.35e-03 1.23e-02  1.14e+04     1s
  25   6.59159668e+10  6.56645393e+10  2.62e-03 7.47e-03  7.54e+03     1s
  26   6.58883010e+10  6.57468201e+10  1.88e-03 3.11e-03  4.14e+03     1s
  27   6.58591531e+10  6.57772215e+10  1.13e-03 1.63e-03  2.38e+03     1s
  28   6.58348588e+10  6.57998335e+10  5.21e-04 5.06e-04  9.98e+02     1s
  29   6.58238183e+10  6.58079373e+10  2.52e-04 1.51e-04  4.45e+02     1s
  30   6.58174373e+10  6.58108084e+10  9.97e-05 5.83e-05  1.86e+02     1s
  31   6.58147023e+10  6.58122832e+10  3.46e-05 1.91e-05  6.76e+01     1s
  32   6.58140814e+10  6.58126651e+10  2.03e-05 9.98e-06  3.95e+01     1s
  33   6.58133760e+10  6.58130505e+10  2.24e-05 1.95e-06  9.05e+00     1s
  34   6.58132374e+10  6.58131117e+10  6.02e-06 9.33e-07  3.53e+00     1s
  35   6.58131844e+10  6.58131733e+10  5.78e-06 8.42e-08  3.15e-01     1s
  36   6.58131805e+10  6.58131801e+10  1.37e-06 1.38e-09  1.01e-02     1s
  37   6.58131804e+10  6.58131804e+10  7.91e-06 2.39e-09  4.70e-05     1s
  38   6.58131804e+10  6.58131804e+10  9.75e-10 2.44e-09  7.30e-10     1s

Barrier solved model in 38 iterations and 1.39 seconds (0.38 work units)
Optimal objective 6.58131804e+10

Crossover log...

     190 DPushes remaining with DInf 0.0000000e+00                 1s
       0 DPushes remaining with DInf 0.0000000e+00                 1s

    1852 PPushes remaining with PInf 0.0000000e+00                 1s
       0 PPushes remaining with PInf 0.0000000e+00                 1s

  Push phase complete: Pinf 0.0000000e+00, Dinf 1.7582710e-09      1s


Solved with barrier
Iteration    Objective       Primal Inf.    Dual Inf.      Time
    2045    6.5813180e+10   0.000000e+00   0.000000e+00      2s

Solved in 2045 iterations and 1.52 seconds (0.53 work units)
Optimal objective  6.581318040e+10
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:pypsa.linopf:Optimization successful. Objective value: 6.58e+10
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;ok&#39;, &#39;optimal&#39;)
</pre></div>
</div>
</div>
</div>
<p>…and inspect the capacities built…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom_opt</span> <span class="c1"># MW</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generator
OCGT            0.000000
onwind     225963.169630
offwind     76925.170810
solar      248437.267074
Name: p_nom_opt, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">p_nom_opt</span> <span class="c1"># MW</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>StorageUnit
battery storage                 34106.689925
hydrogen storage underground    60603.642626
Name: p_nom_opt, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">p_nom_opt</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">max_hours</span> <span class="c1"># GWh</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>StorageUnit
battery storage                   204.640140
hydrogen storage underground    10181.411961
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>… we see quite a bit of storage. So how does the optimised dispatch of the system look like?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_dispatch</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/fneum/miniconda3/envs/pypsa-eur-221227/lib/python3.10/site-packages/pandas/plotting/_matplotlib/core.py:1594: UserWarning:

Attempting to set identical bottom == top == 0.0 results in singular transformations; automatically expanding.
</pre></div>
</div>
<img alt="_images/10-workshop-pypsa-cem_99_1.png" src="_images/10-workshop-pypsa-cem_99_1.png" />
</div>
</div>
<p>We are also keen to see what technologies constitute the largest cost components. For that we’re going to define a small helper function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">system_cost</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">tsc</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">capex</span><span class="p">()</span> <span class="o">+</span> <span class="n">n</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">opex</span><span class="p">(</span><span class="n">aggregate_time</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tsc</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># million €/a</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have an older PyPSA version, the statistics accessor might not be available and you may have to use this alternative, more complicated function with individual items for each cost component:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">system_cost</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">opex</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">generators</span> <span class="o">@</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">marginal_cost</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># M€/a</span>
    <span class="n">capex</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom_opt</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">capital_cost</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># M€/a</span>
    <span class="n">capex_storage</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">p_nom_opt</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">storage_units</span><span class="o">.</span><span class="n">capital_cost</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="c1"># M€/a</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">opex</span><span class="p">,</span> <span class="n">capex</span><span class="p">,</span> <span class="n">capex_storage</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system_cost</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>carrier
battery storage                  3289.077316
hydrogen storage underground    16994.853540
OCGT                                0.000000
offwind                         12168.412459
onwind                          21803.629879
solar                           11557.207204
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>This series, we can then process into plots, e.g. a pie chart:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system_cost</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="_images/10-workshop-pypsa-cem_105_1.png" src="_images/10-workshop-pypsa-cem_105_1.png" />
</div>
</div>
<p>or use to compute the cost per unit of electricity consumed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demand</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">snapshot_weightings</span><span class="o">.</span><span class="n">generators</span> <span class="o">@</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system_cost</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">*</span><span class="mf">1e6</span> <span class="o">/</span> <span class="n">demand</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>137.41834046865426
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Always consider, that the load data is given in units of power (MW) and if your resolution is not hourly, you need to multiply by the snapshot weighting to get the energy consumed!</p>
</div>
</section>
</section>
<section id="sensitivity-analysis">
<h2>Sensitivity Analysis<a class="headerlink" href="#sensitivity-analysis" title="Permalink to this headline">#</a></h2>
<p>Sensitivity analyses constitute a core activity of energy system modelling. Below, you can find sensitivity analyses regarding the</p>
<ol class="simple">
<li><p>variation in allowed CO<span class="math notranslate nohighlight">\(_2\)</span> emissions</p></li>
<li><p>variation in solar overnight costs</p></li>
<li><p>variation in offshore wind potentials</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sensitivity</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">co2</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span>
    <span class="n">n</span><span class="o">.</span><span class="n">global_constraints</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;CO2Limit&quot;</span><span class="p">,</span> <span class="s2">&quot;constant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">co2</span> <span class="o">*</span> <span class="mf">1e6</span>
    <span class="n">n</span><span class="o">.</span><span class="n">lopf</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span>
    <span class="n">sensitivity</span><span class="p">[</span><span class="n">co2</span><span class="p">]</span> <span class="o">=</span> <span class="n">system_cost</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:pypsa.linopf:Prepare linear problem
INFO:pypsa.linopf:Total preparation time: 0.91s
INFO:pypsa.linopf:Solve linear problem using Cbc solver
INFO:pypsa.linopf:Optimization successful. Objective value: 2.76e+10
INFO:pypsa.linopf:Prepare linear problem
INFO:pypsa.linopf:Total preparation time: 0.93s
INFO:pypsa.linopf:Solve linear problem using Cbc solver
INFO:pypsa.linopf:Optimization successful. Objective value: 2.80e+10
INFO:pypsa.linopf:Prepare linear problem
INFO:pypsa.linopf:Total preparation time: 0.93s
INFO:pypsa.linopf:Solve linear problem using Cbc solver
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">275</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="k">for</span> <span class="n">co2</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">n</span><span class="o">.</span><span class="n">global_constraints</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;CO2Limit&quot;</span><span class="p">,</span> <span class="s2">&quot;constant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">co2</span> <span class="o">*</span> <span class="mf">1e6</span>
<span class="ne">----&gt; </span><span class="mi">4</span>     <span class="n">n</span><span class="o">.</span><span class="n">lopf</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">sensitivity</span><span class="p">[</span><span class="n">co2</span><span class="p">]</span> <span class="o">=</span> <span class="n">system_cost</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/pypsa-eur-221227/lib/python3.10/site-packages/pypsa/components.py:769,</span> in <span class="ni">Network.lopf</span><span class="nt">(self, snapshots, pyomo, solver_name, solver_options, solver_logfile, formulation, keep_files, extra_functionality, multi_investment_periods, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">767</span> <span class="k">if</span> <span class="n">pyomo</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">768</span>     <span class="k">return</span> <span class="n">network_lopf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">769</span> <span class="k">return</span> <span class="n">network_lopf_lowmem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/pypsa-eur-221227/lib/python3.10/site-packages/pypsa/linopf.py:1468,</span> in <span class="ni">network_lopf</span><span class="nt">(n, snapshots, solver_name, solver_logfile, extra_functionality, multi_investment_periods, skip_objective, skip_pre, extra_postprocessing, formulation, keep_references, keep_files, keep_shadowprices, solver_options, warmstart, store_basis, solver_dir)</span>
<span class="g g-Whitespace">   </span><span class="mi">1465</span>     <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Solve linear problem using </span><span class="si">{</span><span class="n">solver_name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2"> solver&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1467</span> <span class="n">solve</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;run_and_read_</span><span class="si">{</span><span class="n">solver_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1468</span> <span class="n">res</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1469</span>     <span class="n">n</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1470</span>     <span class="n">problem_fn</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1471</span>     <span class="n">solution_fn</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1472</span>     <span class="n">solver_logfile</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1473</span>     <span class="n">solver_options</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1474</span>     <span class="n">warmstart</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1475</span>     <span class="n">store_basis</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1476</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1478</span> <span class="n">status</span><span class="p">,</span> <span class="n">termination_condition</span><span class="p">,</span> <span class="n">variables_sol</span><span class="p">,</span> <span class="n">constraints_dual</span><span class="p">,</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">res</span>
<span class="g g-Whitespace">   </span><span class="mi">1480</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_files</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/pypsa-eur-221227/lib/python3.10/site-packages/pypsa/linopt.py:847,</span> in <span class="ni">run_and_read_cbc</span><span class="nt">(n, problem_fn, solution_fn, solver_logfile, solver_options, warmstart, store_basis)</span>
<span class="g g-Whitespace">    </span><span class="mi">845</span> <span class="n">log</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">solver_logfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">solver_logfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
<span class="g g-Whitespace">    </span><span class="mi">846</span> <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span> <span class="n">stdout</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">847</span> <span class="n">result</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">849</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">solution_fn</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">850</span>     <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/pypsa-eur-221227/lib/python3.10/subprocess.py:1204,</span> in <span class="ni">Popen.wait</span><span class="nt">(self, timeout)</span>
<span class="g g-Whitespace">   </span><span class="mi">1202</span>     <span class="n">endtime</span> <span class="o">=</span> <span class="n">_time</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout</span>
<span class="g g-Whitespace">   </span><span class="mi">1203</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1204</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1205</span> <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1206</span>     <span class="c1"># https://bugs.python.org/issue25942</span>
<span class="g g-Whitespace">   </span><span class="mi">1207</span>     <span class="c1"># The first keyboard interrupt waits briefly for the child to</span>
<span class="g g-Whitespace">   </span><span class="mi">1208</span>     <span class="c1"># exit under the common assumption that it also received the ^C</span>
<span class="g g-Whitespace">   </span><span class="mi">1209</span>     <span class="c1"># generated SIGINT and will exit rapidly.</span>
<span class="g g-Whitespace">   </span><span class="mi">1210</span>     <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/pypsa-eur-221227/lib/python3.10/subprocess.py:1938,</span> in <span class="ni">Popen._wait</span><span class="nt">(self, timeout)</span>
<span class="g g-Whitespace">   </span><span class="mi">1936</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">returncode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1937</span>     <span class="k">break</span>  <span class="c1"># Another thread waited.</span>
<span class="ne">-&gt; </span><span class="mi">1938</span> <span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">sts</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_wait</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1939</span> <span class="c1"># Check the pid and loop as waitpid has been known to</span>
<span class="g g-Whitespace">   </span><span class="mi">1940</span> <span class="c1"># return 0 even without WNOHANG in odd situations.</span>
<span class="g g-Whitespace">   </span><span class="mi">1941</span> <span class="c1"># http://bugs.python.org/issue14396.</span>
<span class="g g-Whitespace">   </span><span class="mi">1942</span> <span class="k">if</span> <span class="n">pid</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/pypsa-eur-221227/lib/python3.10/subprocess.py:1896,</span> in <span class="ni">Popen._try_wait</span><span class="nt">(self, wait_flags)</span>
<span class="g g-Whitespace">   </span><span class="mi">1894</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;All callers to this function MUST hold self._waitpid_lock.&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1895</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1896</span>     <span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">sts</span><span class="p">)</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">waitpid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">wait_flags</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1897</span> <span class="k">except</span> <span class="ne">ChildProcessError</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1898</span>     <span class="c1"># This happens if SIGCLD is set to be ignored or waiting</span>
<span class="g g-Whitespace">   </span><span class="mi">1899</span>     <span class="c1"># for child processes has otherwise been disabled for our</span>
<span class="g g-Whitespace">   </span><span class="mi">1900</span>     <span class="c1"># process.  This child is dead, we can&#39;t get the status.</span>
<span class="g g-Whitespace">   </span><span class="mi">1901</span>     <span class="n">pid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sensitivity</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span> <span class="c1"># billion Euro/a</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">area</span><span class="p">(</span>
    <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">carriers</span><span class="o">.</span><span class="n">color</span><span class="p">),</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">),</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;CO$_2$ emissions [Mt/a]&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;System cost [bn€/a]&quot;</span><span class="p">,</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">#</a></h2>
<p>Explore the model by changing the assumptions and available technologies. Here are a few inspirations:</p>
<ul class="simple">
<li><p>Rerun the model with cost assumptions for 2050.</p></li>
<li><p>What if either hydrogen or battery storage cannot be expanded?</p></li>
<li><p>What if you can either only build solar or only build wind?</p></li>
<li><p>What if we had a flat electricity demand profile (like in <a class="reference external" href="https://model.energy">model.energy</a>, i.e. average the demand time series)?</p></li>
<li><p>Vary the energy-to-power ratio of the hydrogen storage. What ratio leads to lowest costs?</p></li>
<li><p>How bad is the 4-hourly resolution used for demonstration? How does it compare to hourly or 2-hourly resolution?</p></li>
<li><p>On <a class="reference external" href="https://model.energy">model.energy</a>, you can download capacity factors for onshore wind and solar for any region in the world. Drop offshore wind from the model and use the onshore wind and solar prices from another region of the world. Try a few. What changes?</p></li>
<li><p>Add nuclear as another dispatchable low-emission generation technology (similar to OCGT). Perform a sensitivity analysis trying to answer how low the capital cost of a nuclear plant would need to be to be chosen.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="09-workshop-pypsa.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Introduction to <code class="docutils literal notranslate"><span class="pre">pypsa</span></code></p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="11-workshop-groupwork.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Preparation for Group Assignment</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Fabian Neumann<br/>
  
      &copy; Copyright 2022-2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>