

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Introduction to geopandas and cartopy &#8212; Data Science for Energy System Modelling</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '04-workshop-geopandas';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Introduction to rasterio and atlite" href="06-workshop-atlite.html" />
    <link rel="prev" title="Introduction to pandas" href="03-workshop-pandas.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01-workshop-python.html">Introduction to <code class="docutils literal notranslate"><span class="pre">Python</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="02-workshop-numpy.html">Introduction to <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="03-workshop-pandas.html">Introduction to <code class="docutils literal notranslate"><span class="pre">pandas</span></code></a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Introduction to <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> and <code class="docutils literal notranslate"><span class="pre">cartopy</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="06-workshop-atlite.html">Introduction to <code class="docutils literal notranslate"><span class="pre">rasterio</span></code> and <code class="docutils literal notranslate"><span class="pre">atlite</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="07-workshop-networkx.html">Introduction to <code class="docutils literal notranslate"><span class="pre">networkx</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="08-workshop-pyomo.html">Introduction to <code class="docutils literal notranslate"><span class="pre">pyomo</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="09-workshop-pypsa.html">Introduction to <code class="docutils literal notranslate"><span class="pre">pypsa</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="10-workshop-pypsa-cem.html">Capacity Expansion Planning with <code class="docutils literal notranslate"><span class="pre">pypsa</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="11-workshop-groupwork.html">Preparation for Group Assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="12-workshop-pypsa-sector-coupling.html">Sector-Coupling with <code class="docutils literal notranslate"><span class="pre">pypsa</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="13-workshop-interactive-visualisation.html">Interactive Visualisation and Dashboards</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/fneum/data-science-for-esm/blob/main/data-science-for-esm/04-workshop-geopandas.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/fneum/data-science-for-esm" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/fneum/data-science-for-esm/issues/new?title=Issue%20on%20page%20%2F04-workshop-geopandas.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/04-workshop-geopandas.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Introduction to geopandas and cartopy</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-setup">Basic Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-do-we-need-something-other-than-pandas">Why do we need something other than <code class="docutils literal notranslate"><span class="pre">pandas</span></code>?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#geopandas-a-pandas-extension-for-geospatial-data">Geopandas - a Pandas extension for geospatial data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#map-projections-with-cartopy">Map Projections with Cartopy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reprojecting-a-geodataframe">Reprojecting a <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-and-writing-files-with-geopandas">Reading and Writing Files with <code class="docutils literal notranslate"><span class="pre">geopandas</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-areas-and-buffers">Calculating the areas and buffers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#joining-spatial-datasets">Joining spatial datasets</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="introduction-to-geopandas-and-cartopy">
<h1>Introduction to <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> and <code class="docutils literal notranslate"><span class="pre">cartopy</span></code><a class="headerlink" href="#introduction-to-geopandas-and-cartopy" title="Permalink to this heading">#</a></h1>
<section id="basic-setup">
<h2>Basic Setup<a class="headerlink" href="#basic-setup" title="Permalink to this heading">#</a></h2>
<p>Again, we will be using <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> in this tutorial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have not yet set up Python on your computer, you can execute this tutorial in your browser via Google Colab. Click on the rocket in the top right corner and launch “Colab”. If you have not yet set up Python on your computer, you can execute this tutorial in your browser via <a class="reference external" href="https://colab.research.google.com/">Google Colab</a>. Click on the rocket in the top right corner and launch “Colab”. If that doesn’t work download the <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code> file and import it in <a class="reference external" href="https://colab.research.google.com/">Google Colab</a>.</p>
<p>Then install the following packages by executing the following command in a Jupyter cell at the top of the notebook.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>!apt<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>libgeos-dev
!pip<span class="w"> </span>install<span class="w"> </span>pandas<span class="w"> </span>geopandas<span class="w"> </span>matplotlib<span class="w"> </span>cartopy<span class="w"> </span>mapclassify
</pre></div>
</div>
</div>
</section>
<section id="why-do-we-need-something-other-than-pandas">
<h2>Why do we need something other than <code class="docutils literal notranslate"><span class="pre">pandas</span></code>?<a class="headerlink" href="#why-do-we-need-something-other-than-pandas" title="Permalink to this heading">#</a></h2>
<p>Let’s reload again our example dataset of conventional power plants in Europe as a <code class="docutils literal notranslate"><span class="pre">pd.DataFrame</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/PyPSA/powerplantmatching/master/powerplants.csv&quot;</span>
<span class="n">ppl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This dataset includes coordinates (latitude and longitude), which allows us to plot the location and capacity of all power plants in a scatter plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ppl</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">ppl</span><span class="o">.</span><span class="n">Capacity</span> <span class="o">/</span> <span class="mf">1e3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;lon&#39;, ylabel=&#39;lat&#39;&gt;
</pre></div>
</div>
<img alt="_images/6aeaad014c5a2e29c7f563c7a3f47f29bf527ab11eef28b10cf4591e98a93e52.png" src="_images/6aeaad014c5a2e29c7f563c7a3f47f29bf527ab11eef28b10cf4591e98a93e52.png" />
</div>
</div>
<p>However, this graphs misses some geographic reference point, we’d normally expect for a map like shorelines, country borders etc.</p>
</section>
<section id="geopandas-a-pandas-extension-for-geospatial-data">
<h2>Geopandas - a Pandas extension for geospatial data<a class="headerlink" href="#geopandas-a-pandas-extension-for-geospatial-data" title="Permalink to this heading">#</a></h2>
<img src="https://geopandas.org/en/stable/_images/geopandas_logo.png" width="400px" /><p>Geopandas extends <code class="docutils literal notranslate"><span class="pre">pandas</span></code> by adding support for geospatial data.</p>
<p>The core data structure in GeoPandas is the <code class="docutils literal notranslate"><span class="pre">geopandas.GeoDataFrame</span></code>, a subclass of <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>, that can store geometry columns and perform spatial operations.</p>
<img src="https://geopandas.org/en/stable/_images/dataframe.svg" width="600px" /><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Documentation for this package is available at <a class="reference external" href="https://geopandas.org/en/stable/">https://geopandas.org/en/stable/</a>.</p>
</div>
<p>Typical geometries are points, lines, and polygons. They come from another library called <a class="reference external" href="https://shapely.readthedocs.io/en/stable/manual.html"><code class="docutils literal notranslate"><span class="pre">shapely</span></code></a>, which helps you create, analyze, and manipulate two-dimensional shapes and their properties, such as points, lines, and polygons.</p>
<img src="https://geobgu.xyz/py/_images/simple_feature_types.svg" width="600px" /><p>First, we need to import the <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> package. The conventional alias is <code class="docutils literal notranslate"><span class="pre">gpd</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
</pre></div>
</div>
</div>
</div>
<p>We can convert the latitude and longitude values given in the dataset to formal geometries (to be exact: <code class="docutils literal notranslate"><span class="pre">shapely.Point</span></code> objects but we won’t go into detail regarding this) using the <code class="docutils literal notranslate"><span class="pre">gpd.points_from_xy()</span></code> function, and use this to <code class="docutils literal notranslate"><span class="pre">gpd.GeoDataFrame</span></code>. We should also specify a so-called coordinate reference system (CRS). The code ‘4326’ means latitude and longitude values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geometry</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">ppl</span><span class="p">[</span><span class="s2">&quot;lon&quot;</span><span class="p">],</span> <span class="n">ppl</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">])</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">ppl</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, the <code class="docutils literal notranslate"><span class="pre">gdf</span></code> looks like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Fueltype</th>
      <th>Technology</th>
      <th>Set</th>
      <th>Country</th>
      <th>Capacity</th>
      <th>Efficiency</th>
      <th>DateIn</th>
      <th>DateRetrofit</th>
      <th>DateOut</th>
      <th>lat</th>
      <th>lon</th>
      <th>Duration</th>
      <th>Volume_Mm3</th>
      <th>DamHeight_m</th>
      <th>StorageCapacity_MWh</th>
      <th>EIC</th>
      <th>projectID</th>
      <th>geometry</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Emsland</td>
      <td>Nuclear</td>
      <td>Steam Turbine</td>
      <td>CHP</td>
      <td>Germany</td>
      <td>1336.000000</td>
      <td>0.33</td>
      <td>1988.0</td>
      <td>1988.0</td>
      <td>2022.0</td>
      <td>52.481878</td>
      <td>7.306658</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>{'11WD7KKE-1K--KW5'}</td>
      <td>{'ENTSOE': {'11WD7KKE-1K--KW5'}, 'OPSD': {'BNA...</td>
      <td>POINT (7.30666 52.48188)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Mellach</td>
      <td>Hard Coal</td>
      <td>Steam Turbine</td>
      <td>CHP</td>
      <td>Austria</td>
      <td>200.000000</td>
      <td>NaN</td>
      <td>1986.0</td>
      <td>1986.0</td>
      <td>2020.0</td>
      <td>46.911700</td>
      <td>15.488300</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>{'14W-WML-KW-----0'}</td>
      <td>{'BEYONDCOAL': {'BEYOND-AT-11'}, 'ENTSOE': {'1...</td>
      <td>POINT (15.48830 46.91170)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Eemshaven</td>
      <td>Hard Coal</td>
      <td>CCGT</td>
      <td>PP</td>
      <td>Netherlands</td>
      <td>1604.170304</td>
      <td>0.58</td>
      <td>2015.0</td>
      <td>NaN</td>
      <td>2029.0</td>
      <td>53.440500</td>
      <td>6.861200</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>{'49W000000000044-'}</td>
      <td>{'BEYONDCOAL': {'BEYOND-NL-12'}, 'ENTSOE': {'4...</td>
      <td>POINT (6.86120 53.44050)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>With the additional <code class="docutils literal notranslate"><span class="pre">geometry</span></code> columns, it is now even easier to plot the geographic data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;Fueltype&quot;</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="n">gdf</span><span class="o">.</span><span class="n">Capacity</span> <span class="o">/</span> <span class="mf">1e2</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="_images/5cfec5b58e5d18b0c279d56e5a284c76ee3b43abc3f511ee55378f97fde91e37.png" src="_images/5cfec5b58e5d18b0c279d56e5a284c76ee3b43abc3f511ee55378f97fde91e37.png" />
</div>
</div>
<p>We can also start up an interactive map to explore the geodata in more detail:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;Fueltype&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">File /opt/hostedtoolcache/Python/3.11.4/x64/lib/python3.11/site-packages/geopandas/explore.py:281,</span> in <span class="ni">_explore</span><span class="nt">(df, column, cmap, color, m, tiles, attr, tooltip, popup, highlight, categorical, legend, scheme, k, vmin, vmax, width, height, categories, classification_kwds, control_scale, marker_type, marker_kwds, style_kwds, highlight_kwds, missing_kwds, tooltip_kwds, popup_kwds, legend_kwds, map_kwds, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">280</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">281</span>     <span class="kn">import</span> <span class="nn">branca</span> <span class="k">as</span> <span class="nn">bc</span>
<span class="g g-Whitespace">    </span><span class="mi">282</span>     <span class="kn">import</span> <span class="nn">folium</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;branca&#39;

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">ImportError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">gdf</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;Fueltype&quot;</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.4/x64/lib/python3.11/site-packages/geopandas/geodataframe.py:2101,</span> in <span class="ni">GeoDataFrame.explore</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2099</span> <span class="nd">@doc</span><span class="p">(</span><span class="n">_explore</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2100</span> <span class="k">def</span> <span class="nf">explore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">2101</span>     <span class="k">return</span> <span class="n">_explore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.4/x64/lib/python3.11/site-packages/geopandas/explore.py:297,</span> in <span class="ni">_explore</span><span class="nt">(df, column, cmap, color, m, tiles, attr, tooltip, popup, highlight, categorical, legend, scheme, k, vmin, vmax, width, height, categories, classification_kwds, control_scale, marker_type, marker_kwds, style_kwds, highlight_kwds, missing_kwds, tooltip_kwds, popup_kwds, legend_kwds, map_kwds, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">294</span>         <span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="g g-Whitespace">    </span><span class="mi">296</span> <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">ModuleNotFoundError</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">297</span>     <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">298</span>         <span class="s2">&quot;The &#39;folium&#39;, &#39;matplotlib&#39; and &#39;mapclassify&#39; packages are required for &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">299</span>         <span class="s2">&quot;&#39;explore()&#39;. You can install them using &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">300</span>         <span class="s2">&quot;&#39;conda install -c conda-forge folium matplotlib mapclassify&#39; &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">301</span>         <span class="s2">&quot;or &#39;pip install folium matplotlib mapclassify&#39;.&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">302</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span> <span class="c1"># xyservices is an optional dependency</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span> <span class="k">try</span><span class="p">:</span>

<span class="ne">ImportError</span>: The &#39;folium&#39;, &#39;matplotlib&#39; and &#39;mapclassify&#39; packages are required for &#39;explore()&#39;. You can install them using &#39;conda install -c conda-forge folium matplotlib mapclassify&#39; or &#39;pip install folium matplotlib mapclassify&#39;.
</pre></div>
</div>
</div>
</div>
</section>
<section id="map-projections-with-cartopy">
<h2>Map Projections with Cartopy<a class="headerlink" href="#map-projections-with-cartopy" title="Permalink to this heading">#</a></h2>
<img src="https://scitools.org.uk/cartopy/docs/v0.16/_images/sphx_glr_logo_001.png" width="300px" /><p>Cartopy is a Python package designed for geospatial data processing and has exposed an interface to enable easy map creation using <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>.</p>
<p>The Earth is a globe, but we present maps usually on two-dimensional surfaces. Hence, we typically need to <em>project</em> data points onto flat surfaces (e.g. screens, paper). However, we will always loose some information in doing so.</p>
<img src="https://raw.githubusercontent.com/SciTools/cartopy-tutorial/master/static/orange_peel.jpg" width="500px" />
<p>A map projection is:</p>
<blockquote>
<div><p>a systematic transformation of the latitudes and longitudes of locations from the surface of a sphere or an ellipsoid into locations on a plane. <a class="reference external" href="https://en.wikipedia.org/wiki/Map_projection">Wikipedia: Map projection</a>.</p>
</div></blockquote>
<p>Different projections <strong>preserve different metric properties</strong>. As a result,
converting geodata from one projection to another is a common exercise in geographic data science.</p>
<ul class="simple">
<li><p><strong>conformal projections</strong> preserve angles/directions (e.g. Mercator projection)</p></li>
<li><p><strong>equal-area projections</strong> preserve area measure (e.g. Mollweide)</p></li>
<li><p><strong>equidistant projections</strong> preserve distances between points (e.g. Plate carrée)</p></li>
<li><p><strong>compromise projections</strong> seek to strike a balance between distortions (e.g. Robinson)</p></li>
</ul>
<p>If you like the “Orange-as-Earth” analogy for projections, checkout <a class="reference external" href="https://www.youtube.com/watch?v=D3tdW9l1690">this numberphile video</a> by Hannah Fry.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Documentation for this package is available at <a class="reference external" href="https://scitools.org.uk/cartopy/docs/latest/">https://scitools.org.uk/cartopy/docs/latest/</a>.</p>
</div>
<p>First, we need to import the relevant parts of the <code class="docutils literal notranslate"><span class="pre">cartopy</span></code> package:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cartopy</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s draw a first map with <code class="docutils literal notranslate"><span class="pre">cartopy</span></code> outlining the global coastlines in the so-called <a class="reference external" href="https://en.wikipedia.org/wiki/Equirectangular_projection">plate carrée projection (equirectangular projection)</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>A list of the available projections can be found on the <a class="reference external" href="https://scitools.org.uk/cartopy/docs/latest/reference/projections.html#cartopy-projections">Cartopy projection list page</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We can combine the functionality of <code class="docutils literal notranslate"><span class="pre">cartopy</span></code> with <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> plots:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

<span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;Fueltype&quot;</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="n">gdf</span><span class="o">.</span><span class="n">Capacity</span> <span class="o">/</span> <span class="mf">1e2</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can add further <a class="reference external" href="https://scitools.org.uk/cartopy/docs/latest/matplotlib/feature_interface.html#the-cartopy-feature-interface">geographic features</a> to this map for better orientation.</p>
<p>For instance, we can add the coastlines…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
</div>
<p>… country borders …</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
</div>
<p>… colour in the ocean in blue …</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;azure&quot;</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
</div>
<p>…and color in the land area in yellow …</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;cornsilk&quot;</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
</div>
<p>Geopandas will automatically calculate sensible bounds for the plot given the geographic data.
But we can also manually zoom in or out by setting the spatial extent with the <code class="docutils literal notranslate"><span class="pre">.set_extent()</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">55</span><span class="p">])</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
</div>
<section id="reprojecting-a-geodataframe">
<h3>Reprojecting a <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code><a class="headerlink" href="#reprojecting-a-geodataframe" title="Permalink to this heading">#</a></h3>
<p>In <code class="docutils literal notranslate"><span class="pre">geopandas</span></code>, we can use the function <code class="docutils literal notranslate"><span class="pre">.to_crs()</span></code> to convert a <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> to a desired coordinate reference system. In this particular case, we use the <code class="docutils literal notranslate"><span class="pre">proj4_init</span></code> string of an initialised <code class="docutils literal notranslate"><span class="pre">cartopy</span></code> projection to reproject our power plant <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>.</p>
<blockquote>
<div><p>A <code class="docutils literal notranslate"><span class="pre">proj4_init</span></code> string is a text-based representation of a coordinate reference system (CRS) that defines the parameters for transforming geographical coordinates between different spatial reference systems, used by the PROJ library. It will look similar to this: “+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs”.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">AlbersEqualArea</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>

<span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="o">.</span><span class="n">proj4_init</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">column</span><span class="o">=</span><span class="s2">&quot;Fueltype&quot;</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="n">gdf</span><span class="o">.</span><span class="n">Capacity</span> <span class="o">/</span> <span class="mf">1e2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="reading-and-writing-files-with-geopandas">
<h2>Reading and Writing Files with <code class="docutils literal notranslate"><span class="pre">geopandas</span></code><a class="headerlink" href="#reading-and-writing-files-with-geopandas" title="Permalink to this heading">#</a></h2>
<p>In the following example, we’ll load a dataset containing the <a class="reference external" href="https://en.wikipedia.org/wiki/Nomenclature_of_Territorial_Units_for_Statistics">NUTS regions</a>:</p>
<blockquote>
<div><p>Nomenclature of Territorial Units for Statistics or NUTS (French: Nomenclature des unités territoriales statistiques) is a geocode standard for referencing the subdivisions of countries for statistical purposes.</p>
</div></blockquote>
<p>Our ultimate <strong>goal</strong> for this part of the tutorial is to map the power plant capacities to the NUTS-1 region they belong to.</p>
<img src="https://ec.europa.eu/eurostat/documents/345175/501899/framing" width="400px" /><p>Common filetypes for vector-based geospatial datasets are GeoPackage (<code class="docutils literal notranslate"><span class="pre">.gpkg</span></code>), GeoJSON (<code class="docutils literal notranslate"><span class="pre">.geojson</span></code>), File Geodatabase (<code class="docutils literal notranslate"><span class="pre">.gdb</span></code>), or Shapefiles (<code class="docutils literal notranslate"><span class="pre">.shp</span></code>).</p>
<p>In <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> we can use the <code class="docutils literal notranslate"><span class="pre">gpd.read_file()</span></code> function to read such files. So let’s start:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://tubcloud.tu-berlin.de/s/RHZJrN8Dnfn26nr/download/NUTS_RG_10M_2021_4326.geojson&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>It is good practice to set an index. You can use <code class="docutils literal notranslate"><span class="pre">.set_index()</span></code> for that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts</span> <span class="o">=</span> <span class="n">nuts</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can also check out the geometries in the dataset with <code class="docutils literal notranslate"><span class="pre">.geometry</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts</span><span class="o">.</span><span class="n">geometry</span>
</pre></div>
</div>
</div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">.crs</span></code> we can check in which coordinate reference system the data is given:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts</span><span class="o">.</span><span class="n">crs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts</span><span class="o">.</span><span class="n">total_bounds</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s filter by NUTS-1 level…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts1</span> <span class="o">=</span> <span class="n">nuts</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;LEVL_CODE == 1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>… and explore what kind of geometries we have in the dataset …</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts1</span><span class="o">.</span><span class="n">explore</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>To write a GeoDataFrame back to file use <code class="docutils literal notranslate"><span class="pre">GeoDataFrame.to_file()</span></code>. The file format is inferred from the file ending.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts1</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s2">&quot;tmp.geojson&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculating-the-areas-and-buffers">
<h2>Calculating the areas and buffers<a class="headerlink" href="#calculating-the-areas-and-buffers" title="Permalink to this heading">#</a></h2>
<p>The first thing we need to do to calculate area or buffers is to reproject the <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> to an equal-area projection (here: <a class="reference external" href="https://epsg.io/3035">EPSG:3035</a> which is valid only within Europe; global alternative is the Mollweide projection <a class="reference external" href="https://epsg.io/54009">EPSG:54009</a>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts1</span> <span class="o">=</span> <span class="n">nuts1</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3035</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The area can be accessed via <code class="docutils literal notranslate"><span class="pre">.area</span></code> and is given in m² (after projection). Let’s convert to km²:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">area</span> <span class="o">=</span> <span class="n">nuts1</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="mf">1e6</span>
<span class="n">area</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts1</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">area</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1e5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can also build a buffer of 1km around each geometry using <code class="docutils literal notranslate"><span class="pre">.buffer()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts1</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">explore</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="joining-spatial-datasets">
<h2>Joining spatial datasets<a class="headerlink" href="#joining-spatial-datasets" title="Permalink to this heading">#</a></h2>
<p>Multiple <code class="docutils literal notranslate"><span class="pre">GeoDataFrames</span></code> can be combined via <em>spatial joins</em>.</p>
<p>Observations from two datasets are combined with the <a class="reference external" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.sjoin.html"><code class="docutils literal notranslate"><span class="pre">.sjoin()</span></code></a> function based on their spatial relationship to one another (e.g. whether they are intersecting or overlapping). You can read more about the specific options <a class="reference external" href="https://geopandas.org/en/stable/docs/user_guide/mergingdata.html#binary-predicate-joins">here</a>.</p>
<p>To perform a spatial join, you need to provide the following information:</p>
<ul class="simple">
<li><p>The two GeoDataFrames you want to join (e.g., <code class="docutils literal notranslate"><span class="pre">left_df</span></code> and <code class="docutils literal notranslate"><span class="pre">right_df</span></code>).</p></li>
<li><p>The type of spatial relationship to test (e.g., <code class="docutils literal notranslate"><span class="pre">intersects</span></code>, <code class="docutils literal notranslate"><span class="pre">contains</span></code>, <code class="docutils literal notranslate"><span class="pre">within</span></code>). This is specified using the <code class="docutils literal notranslate"><span class="pre">op</span></code> parameter.</p></li>
<li><p>The type of join to perform (e.g., <code class="docutils literal notranslate"><span class="pre">inner</span></code>, <code class="docutils literal notranslate"><span class="pre">left</span></code>, <code class="docutils literal notranslate"><span class="pre">right</span></code>). This is specified using the <code class="docutils literal notranslate"><span class="pre">how</span></code> parameter.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">.sjoin()</span></code> function will then iterate through the geometries in both GeoDataFrames, evaluate the specified spatial relationship, and join the matching records.</p>
<p>For example, if the <code class="docutils literal notranslate"><span class="pre">op</span></code> parameter is set to ‘intersects’, the function will check if the geometries of each record in <code class="docutils literal notranslate"><span class="pre">left_df</span></code> intersect with the geometries of any records in <code class="docutils literal notranslate"><span class="pre">right_df</span></code>. If a match is found, the attributes of the corresponding records from both GeoDataFrames will be combined into a new record in the output GeoDataFrame.</p>
<p>By performing spatial joins, you can efficiently combine and analyze geospatial data based on their spatial relationships, without the need for explicit coordinate-based calculations.</p>
<p>Let’s first reproject the <code class="docutils literal notranslate"><span class="pre">gdf</span></code> object to the same CRS as <code class="docutils literal notranslate"><span class="pre">nuts1</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3035</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Then, let’s have a look at both datasets at once. We want to find out which points (representing power plants) lie within which shape (representing NUTS regions).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">epsg</span><span class="p">(</span><span class="mi">3035</span><span class="p">))</span>

<span class="n">nuts1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgrey&quot;</span><span class="p">)</span>

<span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3035</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">&quot;Fueltype&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">gdf</span><span class="o">.</span><span class="n">Capacity</span> <span class="o">/</span> <span class="mi">20</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">55</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>We can now apply the <code class="docutils literal notranslate"><span class="pre">.sjoin</span></code> function to look for which power plants lie within which NUTS1 region. By default, <code class="docutils literal notranslate"><span class="pre">sjoin</span></code> looks for intersections and keeps the geometries of the <em>left</em> <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">joined</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">nuts1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If we look at this new <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>, we now have additional columns from the NUTS1 data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">joined</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now use these new columns to group the capacities (and convert to a suitable unit):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cap</span> <span class="o">=</span> <span class="n">joined</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;NUTS_ID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Capacity</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># GW</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s quickly check if all NUTS1 regions have power plants:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts1</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">cap</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This is not the case. Then it is good practice to reindex the series to include all NUTS1 regions, even if this leads to some NaN values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cap</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">nuts1</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cap</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we can plot the total generation capacity per NUTS1 region on a map.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="n">cap</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This concludes the <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> and <code class="docutils literal notranslate"><span class="pre">cartopy</span></code> tutorial.</p>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h2>
<p><strong>Task 1:</strong> Recreate the figure above (i.e. generation capacity per NUTS1 region)</p>
<ul class="simple">
<li><p>using 3 different <a class="reference external" href="https://scitools.org.uk/cartopy/docs/v0.15/crs/projections.html">cartopy projections</a> of your choice.</p></li>
<li><p>such that the capacities are normalised by the area of the NUTS1 region (unit: MW/km²).</p></li>
<li><p>such that it only shows the hard coal power plant capacities.</p></li>
<li><p>such that it only shows NUTS1 shapes for Germany (and Denmark).</p></li>
<li><p>but with NUTS2 regions instead of NUTS1 regions.</p></li>
<li><p>(advanced) such that it shows the capacity-weighted average age of the power plants instead of the capacities. Where are the oldest generators? Can you think of a reason why?</p></li>
</ul>
<p>Which German NUTS2 region has the highest conventional generation capacity? Can you think of a reason why?</p>
<p>Three projections of choice:</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">crs</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ccrs</span><span class="o">.</span><span class="n">EqualEarth</span><span class="p">(),</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">AlbersEqualArea</span><span class="p">(),</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">()]:</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
    <span class="n">nuts1</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="o">.</span><span class="n">proj4_init</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">cap</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Normalised by area in MW/km²:</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="n">cap</span> <span class="o">/</span> <span class="p">(</span><span class="n">nuts1</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="mf">1e9</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Only hard coal generators:</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hard_coal_cap</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">joined</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Fueltype == &#39;Hard Coal&#39;&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;NUTS_ID&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">Capacity</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">nuts1</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mf">1e3</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">nuts1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
    <span class="n">column</span><span class="o">=</span><span class="n">hard_coal_cap</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">missing_kwds</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgrey&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">1e6</span><span class="p">,</span> <span class="mf">6e6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">2e6</span><span class="p">,</span> <span class="mf">6e6</span><span class="p">);</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Only Germany:</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subregion</span> <span class="o">=</span> <span class="n">nuts1</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CNTR_CODE == &#39;DE&#39;&quot;</span><span class="p">)</span>
<span class="n">subregion</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">cap</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">subregion</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Only Germany and Denmark:</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">countries</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DE&quot;</span><span class="p">,</span> <span class="s2">&quot;DK&quot;</span><span class="p">]</span>
<span class="n">subregion</span> <span class="o">=</span> <span class="n">nuts1</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CNTR_CODE in @countries&quot;</span><span class="p">)</span>  <span class="c1"># alternative A</span>
<span class="n">subregion</span> <span class="o">=</span> <span class="n">nuts1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nuts1</span><span class="o">.</span><span class="n">CNTR_CODE</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">countries</span><span class="p">)]</span>  <span class="c1"># alternative B</span>
<span class="n">subregion</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">cap</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">subregion</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>In NUTS2 rather than NUTS1:</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuts2</span> <span class="o">=</span> <span class="n">nuts</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;LEVL_CODE == 2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3035</span><span class="p">)</span>
<span class="n">joined2</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">nuts2</span><span class="p">)</span>
<span class="n">cap2</span> <span class="o">=</span> <span class="n">joined2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;NUTS_ID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Capacity</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">nuts2</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>  <span class="c1"># GW</span>
<span class="n">nuts2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="n">cap2</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>NUTS2 region with highest capacity:</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cap2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># alternative A</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cap2</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>  <span class="c1"># alternative B</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Capacity-weighted average age:</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_weighted_age</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formula:</span>
<span class="sd">    \bar{x} = \frac{ \sum\limits_{i=1}^n w_i x_i}{\sum\limits_{i=1}^n w_i}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">numerator</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Capacity</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">DateIn</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># only build sum of capacities where a date is given</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">Capacity</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">x</span><span class="o">.</span><span class="n">DateIn</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>


<span class="n">age</span> <span class="o">=</span> <span class="n">joined</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;NUTS_ID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">calculate_weighted_age</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">nuts1</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="n">nuts1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="n">age</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p><strong>Task 2:</strong> Load the following <code class="docutils literal notranslate"><span class="pre">.gpkg</span></code> file containing the Danish <a class="reference external" href="https://en.wikipedia.org/wiki/Natura_2000">Natura2000</a> natural protection areas as <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>:</p>
<p><a class="reference external" href="https://tubcloud.tu-berlin.de/s/mEpdmgBtmMbyjAr/download/Natura2000_end2021-DK.gpkg">https://tubcloud.tu-berlin.de/s/mEpdmgBtmMbyjAr/download/Natura2000_end2021-DK.gpkg</a></p>
<ul class="simple">
<li><p>How many individual natural protection areas are there?</p></li>
<li><p>What is the name of the largest natural protection area in Denmark?</p></li>
<li><p>What is the total protection area in square kilometers (make sure you don’t double-count overlapping areas by running the <a class="reference external" href="https://geopandas.org/en/stable/docs/user_guide/aggregation_with_dissolve.html#dissolve-example"><code class="docutils literal notranslate"><span class="pre">.dissolve()</span></code></a> function).</p></li>
<li><p>(advanced) Use <a class="reference external" href="https://geopandas.org/en/stable/docs/user_guide/set_operations.html#set-operations-with-overlay">set operations with the <code class="docutils literal notranslate"><span class="pre">.overlay()</span></code> function</a> and the NUTS1 regions <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> to identify what share of Danish natural protection areas is at sea.</p></li>
</ul>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://tubcloud.tu-berlin.de/s/mEpdmgBtmMbyjAr/download/Natura2000_end2021-DK.gpkg&quot;</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">natura</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">natura</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">natura</span><span class="o">.</span><span class="n">crs</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>How many:</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">natura</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Name of largest protection area:</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="n">natura</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<span class="n">i</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">natura</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Total area in km²:</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total</span> <span class="o">=</span> <span class="n">natura</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="mf">1e6</span>  <span class="c1"># sqkm</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Share of natural protection area offshore:</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">onshore_natura</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">nuts1</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(),</span> <span class="n">total</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">onshore_natura</span><span class="o">.</span><span class="n">explore</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="o">-</span> <span class="n">onshore_natura</span><span class="o">.</span><span class="n">area</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">total</span><span class="o">.</span><span class="n">area</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: ""
        },
        kernelOptions: {
            name: "",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = ''</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="03-workshop-pandas.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction to <code class="docutils literal notranslate"><span class="pre">pandas</span></code></p>
      </div>
    </a>
    <a class="right-next"
       href="06-workshop-atlite.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Introduction to <code class="docutils literal notranslate"><span class="pre">rasterio</span></code> and <code class="docutils literal notranslate"><span class="pre">atlite</span></code></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-setup">Basic Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-do-we-need-something-other-than-pandas">Why do we need something other than <code class="docutils literal notranslate"><span class="pre">pandas</span></code>?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#geopandas-a-pandas-extension-for-geospatial-data">Geopandas - a Pandas extension for geospatial data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#map-projections-with-cartopy">Map Projections with Cartopy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reprojecting-a-geodataframe">Reprojecting a <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-and-writing-files-with-geopandas">Reading and Writing Files with <code class="docutils literal notranslate"><span class="pre">geopandas</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-areas-and-buffers">Calculating the areas and buffers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#joining-spatial-datasets">Joining spatial datasets</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Fabian Neumann
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022-2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>